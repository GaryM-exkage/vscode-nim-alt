module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=require("vscode")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(4),o=n(11),a=n(5),s=n(0);let u={};var c=[],l=[];function f(){let e=m("nim");return e||s.window.showInformationMessage("No 'nim' binary could be found in PATH environment variable"),e}function h(e){if(i.isAbsolute(e)){let t=s.workspace.getWorkspaceFolder(s.Uri.file(e));if(t)return{wsFolder:t,filePath:s.workspace.asRelativePath(e,!1)}}else if(s.workspace.workspaceFolders&&s.workspace.workspaceFolders.length>0){if(1===s.workspace.workspaceFolders.length)return{wsFolder:s.workspace.workspaceFolders[0],filePath:e};{let t=e.split("/");if(t.length>1)for(const n of s.workspace.workspaceFolders)if(t[0]===n.name)return{wsFolder:n,filePath:e.substr(t[0].length+1)}}}let t=i.parse(e);return{wsFolder:{uri:s.Uri.file(t.dir),name:"root",index:0},filePath:t.base}}function p(e){return e.wsFolder.uri.with({path:e.wsFolder.uri.path+"/"+e.filePath}).fsPath}function d(){return c.length>0}function m(e){if(u[e])return u[e];if(process.env.PATH){process.env.PATH=process.env.PATH+i.delimiter+process.env.HOME+"/.nimble/bin";var t=process.env.PATH.split(i.delimiter);if(u[e]=t.map(t=>i.join(t,g(e))).filter(e=>r.existsSync(e))[0],"win32"!==process.platform)try{let t;"darwin"===process.platform?(t=a.execFileSync("readlink",[u[e]]).toString().trim(),t.length>0&&!i.isAbsolute(t)&&(t=i.normalize(i.join(i.dirname(u[e]),t)))):t="linux"===process.platform?a.execFileSync("readlink",["-f",u[e]]).toString().trim():a.execFileSync("readlink",[u[e]]).toString().trim(),t.length>0&&(u[e]=t)}catch(e){}}return u[e]}function g(e){return"win32"===process.platform?e+".exe":e}let y;function v(){return y||(y=s.window.createOutputChannel("Nim")),y}function w(e,t){let n="";for(let r=t.length;r<e;r++)n+="0";return n+t}t.getNimExecPath=f,t.isWorkspaceFile=function(e){if(s.workspace.workspaceFolders)for(const t of s.workspace.workspaceFolders)if("file"===t.uri.scheme&&e.toLowerCase().startsWith(t.uri.fsPath.toLowerCase()))return!0;return!1},t.toProjectInfo=h,t.toLocalFile=p,t.getNimPrettyExecPath=function(){if(!u.nimpretty){let e=i.resolve(i.dirname(f()),g("nimpretty"));r.existsSync(e)?u.nimpretty=e:u.nimpretty=""}return u.nimpretty},t.getNimbleExecPath=function(){if(!u.nimble){let e=i.resolve(i.dirname(f()),g("nimble"));r.existsSync(e)?u.nimble=e:u.nimble=""}return u.nimble},t.getProjectFileInfo=function(e){if(!d()){if(l.length>0){var t;let n=s.Uri.file(e).path;return l.forEach(e=>{e.fileRegex.test(n)&&(t=h(n.replace(e.fileRegex,e.projectPath)))}),t||(t=h(e)),t}return h(e)}for(const t of c)if(e.startsWith(i.dirname(p(t))))return t;return c[0]},t.getDirtyFile=function(e){var t=i.normalize(i.join(o.tmpdir(),"vscodenimdirty.nim"));return r.writeFileSync(t,e.getText()),t},t.isProjectMode=d,t.getProjects=function(){return c},t.prepareConfig=function(){let e=s.workspace.getConfiguration("nim"),t=e.project;c=[],t&&(t instanceof Array?t.forEach(e=>{c.push(h(e))}):s.workspace.findFiles(t).then(e=>{e&&e.length>0&&c.push(h(e[0].fsPath))}));let n=e.projectMapping;if(l=[],n&&n instanceof Object)for(const e in n)if(n.hasOwnProperty(e)){const t=n[e];l.push({fileRegex:new RegExp(e),projectPath:t})}},t.getBinPath=m,t.correctBinname=g,t.removeDirSync=function e(t){r.existsSync(t)&&(r.readdirSync(t).forEach((n,o)=>{var a=i.resolve(t,n);r.lstatSync(a).isDirectory()?e(a):r.unlinkSync(a)}),r.rmdirSync(t))},t.getOutputChannel=v,t.outputLine=function(e){let t=v(),n=new Date;var r;t.appendLine(`${r=n,`${r.getFullYear()}-${w(2,r.getMonth().toString())}-${w(2,r.getDate().toString())} ${w(2,r.getHours().toString())}:${w(2,r.getMinutes().toString())}:${w(2,r.getSeconds().toString())}.${w(3,r.getMilliseconds().toString())}`} - ${e}`)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(5),a=n(4),s=n(3),u=n(20),c=n(1),l=n(23);let f={};var h,p="",d="";!function(e){e[e.sug=0]="sug",e[e.con=1]="con",e[e.def=2]="def",e[e.use=3]="use",e[e.dus=4]="dus",e[e.chk=5]="chk",e[e.highlight=6]="highlight",e[e.outline=7]="outline",e[e.known=8]="known"}(h=t.NimSuggestType||(t.NimSuggestType={}));class m{constructor(){this.answerType="",this.suggest="",this.names=[],this.type="",this.path="",this.line=1,this.column=0,this.documentation=""}get range(){return new i.Range(this.line-1,this.column,this.line-1,this.column)}get position(){return new i.Position(this.line-1,this.column)}get uri(){return i.Uri.file(this.path)}get location(){return new i.Location(this.uri,this.position)}get fullName(){return this.names?this.names.join("."):""}get symbolName(){return this.names?this.names[this.names.length-1]:""}get moduleName(){return this.names?this.names[0]:""}get containerName(){return this.names?this.names.slice(0,this.names.length-1).join("."):""}}function g(){return p}function y(e,t,n){i.workspace.getConfiguration("nim").get("logNimsuggest")&&("string"==typeof t?console.log("["+e+":"+t+"]"):console.log("["+e+":"+t.wsFolder.name+":"+t.wsFolder.uri.fsPath+":"+t.filePath+"]"),console.log(n))}function v(e){return r(this,void 0,void 0,(function*(){var t=c.toLocalFile(e);if(f[t])try{let e=yield f[t];e&&(e.rpc&&e.rpc.stop(),e.process&&e.process.kill()),f[t]=void 0}catch(e){f[t]=void 0}}))}t.NimSuggestResult=m,t.getNimSuggestPath=g,t.getNimSuggestVersion=function(){return d},t.isNimSuggestVersion=function(e){if(!d)return!1;let t=d.split("."),n=e.split(".");for(var r=0;r<Math.min(t.length,n.length);r++){let e=parseInt(t[r])-parseInt(n[r]);if(0!==e)return e>0}return!0},t.initNimSuggest=function(){c.prepareConfig();let e=a.resolve(a.dirname(c.getNimExecPath()),c.correctBinname("nimsuggest"));if(s.existsSync(e)){p=e;let t=o.spawnSync(g(),["--version"],{cwd:i.workspace.rootPath}).output.toString(),n=/.+Version\s([\d|\.]+)\s\(.+/g.exec(t);n&&2===n.length&&(d=n[1]),console.log(t),console.log("Nimsuggest version: "+d)}i.workspace.onDidChangeConfiguration(c.prepareConfig)},t.execNimSuggest=function(e,t,n,p,d){return r(this,void 0,void 0,(function*(){if(!g())return[];if(".nims"===a.extname(t).toLowerCase()||".cfg"===a.extname(t).toLowerCase())return[];let w=c.getProjectFileInfo(t);try{let a=t.replace(/\\+/g,"/"),N=yield function(e){return r(this,void 0,void 0,(function*(){let t=c.toLocalFile(e);var n;return l.createInterface(s.createReadStream(t)).on("line",e=>{var t=e.split(" ");3==t.length&&"backend"==t[0].toLowerCase()&&"="==t[1]&&(n=t[2])}),f[t]||(f[t]=new Promise((r,a)=>{let s=i.workspace.getConfiguration("nim");var c=["--epc","--v2"];s.logNimsuggest&&c.push("--log"),s.useNimsuggestCheck&&c.push("--refresh:on"),"js"==n.toLowerCase()&&c.push("-d:js"),c.push(e.filePath);let l=o.spawn(g(),c,{cwd:e.wsFolder.uri.fsPath});l.stdout.once("data",e=>{let t=e.toString(),n=parseInt(t);isNaN(n)?a("Nimsuggest returns unknown port number: "+t):u.startClient(n).then(e=>{r({process:l,rpc:e})})}),l.stdout.once("data",e=>{console.log(e.toString())}),l.stderr.once("data",e=>{console.log(e.toString())}),l.on("close",(e,n)=>{0!==e&&console.error("nimsuggest closed with code: "+e+", signal: "+n),f[t]&&f[t].then(e=>{e&&e.rpc&&e.rpc.stop()}),a()})})),f[t]}))}(w),O=h[e];N&&N.process&&y(N.process.pid,w,O+" "+a+":"+n+":"+p);var k=[];if(N&&N.rpc){let e=yield N.rpc.callMethod(O,{kind:"string",str:a},{kind:"number",n:n},{kind:"number",n:p},{kind:"string",str:d});if(N.process&&y(N.process.pid,c.toLocalFile(w)+"="+O+" "+a,e),null!=e)if(e instanceof Array)for(var b=0;b<e.length;b++){var x=e[b];if(x.length>=8){var P=new m;P.answerType=x[0],P.suggest=x[1],P.names=x[2],P.path=x[3].replace(/\\,\\/g,"\\"),P.type=x[4],P.line=x[5],P.column=x[6];var E=x[7];""!==E&&(E=(E=(E=E.replace(/\`\`/g,"`")).replace(/\.\. code-block:: (\w+)\r?\n(( .*\r?\n?)+)/g,"```$1\n$2\n```\n")).replace(/\`([^\<\`]+)\<([^\>]+)\>\`\_/g,"[$1]($2)")),P.documentation=E,k.push(P)}}else if("EPC Connection closed"===e)console.error(e),yield v(w);else{var S=new m;S.suggest=""+e,k.push(S)}}return!c.isProjectMode()&&i.window.visibleTextEditors.every((e,n,r)=>e.document.uri.fsPath!==t)&&(yield v(w)),k}catch(e){console.error(e),yield v(w)}}))},t.closeAllNimSuggestProcesses=function(){return r(this,void 0,void 0,(function*(){for(var e in console.log("Close all nimsuggest processes"),f){let t=yield f[e];t&&(t.rpc&&t.rpc.stop(),t.process&&t.process.kill())}f={}}))},t.closeNimSuggestProcess=v},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("util")},function(e,t,n){(function(){var n=this,r=n._,i={},o=Array.prototype,a=Object.prototype,s=Function.prototype,u=o.push,c=o.slice,l=o.concat,f=a.toString,h=a.hasOwnProperty,p=o.forEach,d=o.map,m=o.reduce,g=o.reduceRight,y=o.filter,v=o.every,w=o.some,k=o.indexOf,b=o.lastIndexOf,x=Array.isArray,P=Object.keys,E=s.bind,S=function(e){return e instanceof S?e:this instanceof S?void(this._wrapped=e):new S(e)};e.exports&&(t=e.exports=S),t._=S,S.VERSION="1.4.4";var N=S.each=S.forEach=function(e,t,n){if(null!=e)if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;r<o;r++)if(t.call(n,e[r],r,e)===i)return}else for(var a in e)if(S.has(e,a)&&t.call(n,e[a],a,e)===i)return};S.map=S.collect=function(e,t,n){var r=[];return null==e?r:d&&e.map===d?e.map(t,n):(N(e,(function(e,i,o){r[r.length]=t.call(n,e,i,o)})),r)};var O="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(N(e,(function(e,o,a){i?n=t.call(r,n,e,o,a):(n=e,i=!0)})),!i)throw new TypeError(O);return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var a=S.keys(e);o=a.length}if(N(e,(function(s,u,c){u=a?a[--o]:--o,i?n=t.call(r,n,e[u],u,c):(n=e[u],i=!0)})),!i)throw new TypeError(O);return n},S.find=S.detect=function(e,t,n){var r;return I(e,(function(e,i,o){if(t.call(n,e,i,o))return r=e,!0})),r},S.filter=S.select=function(e,t,n){var r=[];return null==e?r:y&&e.filter===y?e.filter(t,n):(N(e,(function(e,i,o){t.call(n,e,i,o)&&(r[r.length]=e)})),r)},S.reject=function(e,t,n){return S.filter(e,(function(e,r,i){return!t.call(n,e,r,i)}),n)},S.every=S.all=function(e,t,n){t||(t=S.identity);var r=!0;return null==e?r:v&&e.every===v?e.every(t,n):(N(e,(function(e,o,a){if(!(r=r&&t.call(n,e,o,a)))return i})),!!r)};var I=S.some=S.any=function(e,t,n){t||(t=S.identity);var r=!1;return null==e?r:w&&e.some===w?e.some(t,n):(N(e,(function(e,o,a){if(r||(r=t.call(n,e,o,a)))return i})),!!r)};S.contains=S.include=function(e,t){return null!=e&&(k&&e.indexOf===k?-1!=e.indexOf(t):I(e,(function(e){return e===t})))},S.invoke=function(e,t){var n=c.call(arguments,2),r=S.isFunction(t);return S.map(e,(function(e){return(r?t:e[t]).apply(e,n)}))},S.pluck=function(e,t){return S.map(e,(function(e){return e[t]}))},S.where=function(e,t,n){return S.isEmpty(t)?n?null:[]:S[n?"find":"filter"](e,(function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0}))},S.findWhere=function(e,t){return S.where(e,t,!0)},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return N(e,(function(e,i,o){var a=t?t.call(n,e,i,o):e;a>=r.computed&&(r={value:e,computed:a})})),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return N(e,(function(e,i,o){var a=t?t.call(n,e,i,o):e;a<r.computed&&(r={value:e,computed:a})})),r.value},S.shuffle=function(e){var t,n=0,r=[];return N(e,(function(e){t=S.random(n++),r[n-1]=r[t],r[t]=e})),r};var A=function(e){return S.isFunction(e)?e:function(t){return t[e]}};S.sortBy=function(e,t,n){var r=A(t);return S.pluck(S.map(e,(function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index<t.index?-1:1})),"value")};var _=function(e,t,n,r){var i={},o=A(t||S.identity);return N(e,(function(t,a){var s=o.call(n,t,a,e);r(i,s,t)})),i};S.groupBy=function(e,t,n){return _(e,t,n,(function(e,t,n){(S.has(e,t)?e[t]:e[t]=[]).push(n)}))},S.countBy=function(e,t,n){return _(e,t,n,(function(e,t){S.has(e,t)||(e[t]=0),e[t]++}))},S.sortedIndex=function(e,t,n,r){for(var i=(n=null==n?S.identity:A(n)).call(r,t),o=0,a=e.length;o<a;){var s=o+a>>>1;n.call(r,e[s])<i?o=s+1:a=s}return o},S.toArray=function(e){return e?S.isArray(e)?c.call(e):e.length===+e.length?S.map(e,S.identity):S.values(e):[]},S.size=function(e){return null==e?0:e.length===+e.length?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:c.call(e,0,t)},S.initial=function(e,t,n){return c.call(e,0,e.length-(null==t||n?1:t))},S.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:c.call(e,Math.max(e.length-t,0))},S.rest=S.tail=S.drop=function(e,t,n){return c.call(e,null==t||n?1:t)},S.compact=function(e){return S.filter(e,S.identity)};var $=function(e,t,n){return N(e,(function(e){S.isArray(e)?t?u.apply(n,e):$(e,t,n):n.push(e)})),n};S.flatten=function(e,t){return $(e,t,[])},S.without=function(e){return S.difference(e,c.call(arguments,1))},S.uniq=S.unique=function(e,t,n,r){S.isFunction(t)&&(r=n,n=t,t=!1);var i=n?S.map(e,n,r):e,o=[],a=[];return N(i,(function(n,r){(t?r&&a[a.length-1]===n:S.contains(a,n))||(a.push(n),o.push(e[r]))})),o},S.union=function(){return S.uniq(l.apply(o,arguments))},S.intersection=function(e){var t=c.call(arguments,1);return S.filter(S.uniq(e),(function(e){return S.every(t,(function(t){return S.indexOf(t,e)>=0}))}))},S.difference=function(e){var t=l.apply(o,c.call(arguments,1));return S.filter(e,(function(e){return!S.contains(t,e)}))},S.zip=function(){for(var e=c.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t),r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},S.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return e[r=S.sortedIndex(e,t)]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(k&&e.indexOf===k)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},S.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,o=new Array(r);i<r;)o[i++]=e,e+=n;return o},S.bind=function(e,t){if(e.bind===E&&E)return E.apply(e,c.call(arguments,1));var n=c.call(arguments,2);return function(){return e.apply(t,n.concat(c.call(arguments)))}},S.partial=function(e){var t=c.call(arguments,1);return function(){return e.apply(this,t.concat(c.call(arguments)))}},S.bindAll=function(e){var t=c.call(arguments,1);return 0===t.length&&(t=S.functions(e)),N(t,(function(t){e[t]=S.bind(e[t],e)})),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=c.call(arguments,2);return setTimeout((function(){return e.apply(null,n)}),t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(c.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,o,a=0,s=function(){a=new Date,i=null,o=e.apply(n,r)};return function(){var u=new Date,c=t-(u-a);return n=this,r=arguments,c<=0?(clearTimeout(i),i=null,a=u,o=e.apply(n,r)):i||(i=setTimeout(s,c)),o}},S.debounce=function(e,t,n){var r,i;return function(){var o=this,a=arguments,s=function(){r=null,n||(i=e.apply(o,a))},u=n&&!r;return clearTimeout(r),r=setTimeout(s,t),u&&(i=e.apply(o,a)),i}},S.once=function(e){var t,n=!1;return function(){return n||(n=!0,t=e.apply(this,arguments),e=null),t}},S.wrap=function(e,t){return function(){var n=[e];return u.apply(n,arguments),t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=P||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){var t=[];for(var n in e)S.has(e,n)&&t.push(e[n]);return t},S.pairs=function(e){var t=[];for(var n in e)S.has(e,n)&&t.push([n,e[n]]);return t},S.invert=function(e){var t={};for(var n in e)S.has(e,n)&&(t[e[n]]=n);return t},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return N(c.call(arguments,1),(function(t){if(t)for(var n in t)e[n]=t[n]})),e},S.pick=function(e){var t={},n=l.apply(o,c.call(arguments,1));return N(n,(function(n){n in e&&(t[n]=e[n])})),t},S.omit=function(e){var t={},n=l.apply(o,c.call(arguments,1));for(var r in e)S.contains(n,r)||(t[r]=e[r]);return t},S.defaults=function(e){return N(c.call(arguments,1),(function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])})),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e};var C=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof S&&(e=e._wrapped),t instanceof S&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return r[o]==t;n.push(e),r.push(t);var a=0,s=!0;if("[object Array]"==i){if(s=(a=e.length)==t.length)for(;a--&&(s=C(e[a],t[a],n,r)););}else{var u=e.constructor,c=t.constructor;if(u!==c&&!(S.isFunction(u)&&u instanceof u&&S.isFunction(c)&&c instanceof c))return!1;for(var l in e)if(S.has(e,l)&&(a++,!(s=S.has(t,l)&&C(e[l],t[l],n,r))))break;if(s){for(l in t)if(S.has(t,l)&&!a--)break;s=!a}}return n.pop(),r.pop(),s};S.isEqual=function(e,t){return C(e,t,[],[])},S.isEmpty=function(e){if(null==e)return!0;if(S.isArray(e)||S.isString(e))return 0===e.length;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!(!e||1!==e.nodeType)},S.isArray=x||function(e){return"[object Array]"==f.call(e)},S.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],(function(e){S["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}})),S.isArguments(arguments)||(S.isArguments=function(e){return!(!e||!S.has(e,"callee"))}),S.isFunction=function(e){return"function"==typeof e},S.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},S.isNaN=function(e){return S.isNumber(e)&&e!=+e},S.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==f.call(e)},S.isNull=function(e){return null===e},S.isUndefined=function(e){return void 0===e},S.has=function(e,t){return h.call(e,t)},S.noConflict=function(){return n._=r,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=Array(e),i=0;i<e;i++)r[i]=t.call(n,i);return r},S.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};j.unescape=S.invert(j.escape);var D={escape:new RegExp("["+S.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(j.unescape).join("|")+")","g")};S.each(["escape","unescape"],(function(e){S[e]=function(t){return null==t?"":(""+t).replace(D[e],(function(t){return j[e][t]}))}})),S.result=function(e,t){if(null==e)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){N(S.functions(e),(function(t){var n=S[t]=e[t];S.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),R.call(this,n.apply(S,e))}}))};var F=0;S.uniqueId=function(e){var t=++F+"";return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,T={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(e,t,n){var r;n=S.defaults({},n,S.templateSettings);var i=new RegExp([(n.escape||M).source,(n.interpolate||M).source,(n.evaluate||M).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(i,(function(t,n,r,i,s){return a+=e.slice(o,s).replace(K,(function(e){return"\\"+T[e]})),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+t.length,t})),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(n.variable||"obj","_",a)}catch(e){throw e.source=a,e}if(t)return r(t,S);var s=function(e){return r.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+a+"}",s},S.chain=function(e){return S(e).chain()};var R=function(e){return this._chain?S(e).chain():e};S.mixin(S),N(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=o[e];S.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],R.call(this,n)}})),N(["concat","join","slice"],(function(e){var t=o[e];S.prototype[e]=function(){return R.call(this,t.apply(this._wrapped,arguments))}})),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(e,t,n){var r=n(6),i=n(7),o={},a={},s={},u={},c={};function l(e,t){if("number"==typeof e&&(e=e.toString()),!("$"!==e[0]||"$$date"===e&&"number"==typeof t||"$$deleted"===e&&!0===t||"$$indexCreated"===e||"$$indexRemoved"===e))throw new Error("Field names cannot begin with the $ character");if(-1!==e.indexOf("."))throw new Error("Field names cannot contain a .")}function f(e){r.isArray(e)&&e.forEach((function(e){f(e)})),"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){l(t,e[t]),f(e[t])}))}function h(e,t){var n;return"boolean"==typeof e||"number"==typeof e||"string"==typeof e||null===e||r.isDate(e)?e:r.isArray(e)?(n=[],e.forEach((function(e){n.push(h(e,t))})),n):"object"==typeof e?(n={},Object.keys(e).forEach((function(r){(!t||"$"!==r[0]&&-1===r.indexOf("."))&&(n[r]=h(e[r],t))})),n):void 0}function p(e){return"boolean"==typeof e||"number"==typeof e||"string"==typeof e||null===e||r.isDate(e)||r.isArray(e)}function d(e,t){return e<t?-1:e>t?1:0}function m(e,t){var n,r;for(n=0;n<Math.min(e.length,t.length);n+=1)if(0!==(r=g(e[n],t[n])))return r;return d(e.length,t.length)}function g(e,t,n){var i,o,a,s,u=n||d;if(void 0===e)return void 0===t?0:-1;if(void 0===t)return void 0===e?0:1;if(null===e)return null===t?0:-1;if(null===t)return null===e?0:1;if("number"==typeof e)return"number"==typeof t?d(e,t):-1;if("number"==typeof t)return"number"==typeof e?d(e,t):1;if("string"==typeof e)return"string"==typeof t?u(e,t):-1;if("string"==typeof t)return"string"==typeof e?u(e,t):1;if("boolean"==typeof e)return"boolean"==typeof t?d(e,t):-1;if("boolean"==typeof t)return"boolean"==typeof e?d(e,t):1;if(r.isDate(e))return r.isDate(t)?d(e.getTime(),t.getTime()):-1;if(r.isDate(t))return r.isDate(e)?d(e.getTime(),t.getTime()):1;if(r.isArray(e))return r.isArray(t)?m(e,t):-1;if(r.isArray(t))return r.isArray(e)?m(e,t):1;for(i=Object.keys(e).sort(),o=Object.keys(t).sort(),s=0;s<Math.min(i.length,o.length);s+=1)if(0!==(a=g(e[i[s]],t[o[s]])))return a;return d(i.length,o.length)}function y(e,t){var n,i,o="string"==typeof t?t.split("."):t;if(e){if(0===o.length)return e;if(1===o.length)return e[o[0]];if(r.isArray(e[o[0]])){if("number"==typeof(n=parseInt(o[1],10))&&!isNaN(n))return y(e[o[0]][n],o.slice(2));for(i=new Array,n=0;n<e[o[0]].length;n+=1)i.push(y(e[o[0]][n],o.slice(1)));return i}return y(e[o[0]],o.slice(1))}}function v(e,t){var n,i,o;if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t)return e===t;if(r.isDate(e)||r.isDate(t))return r.isDate(e)&&r.isDate(t)&&e.getTime()===t.getTime();if((!r.isArray(e)||!r.isArray(t))&&(r.isArray(e)||r.isArray(t))||void 0===e||void 0===t)return!1;try{n=Object.keys(e),i=Object.keys(t)}catch(e){return!1}if(n.length!==i.length)return!1;for(o=0;o<n.length;o+=1){if(-1===i.indexOf(n[o]))return!1;if(!v(e[n[o]],t[n[o]]))return!1}return!0}function w(e,t){return!("string"!=typeof e&&"number"!=typeof e&&!r.isDate(e)&&"string"!=typeof t&&"number"!=typeof t&&!r.isDate(t))&&typeof e==typeof t}function k(e,t){var n,r,i,o;if(p(e)||p(t))return b({needAKey:e},"needAKey",t);for(n=Object.keys(t),o=0;o<n.length;o+=1)if(i=t[r=n[o]],"$"===r[0]){if(!u[r])throw new Error("Unknown logical operator "+r);if(!u[r](e,i))return!1}else if(!b(e,r,i))return!1;return!0}function b(e,t,n,o){var a,u,l,f,h=y(e,t);if(r.isArray(h)&&!o){if(r.isArray(n))return b(e,t,n,!0);if(null!==n&&"object"==typeof n&&!r.isRegExp(n))for(u=Object.keys(n),a=0;a<u.length;a+=1)if(c[u[a]])return b(e,t,n,!0);for(a=0;a<h.length;a+=1)if(b({k:h[a]},"k",n))return!0;return!1}if(null!==n&&"object"==typeof n&&!r.isRegExp(n)&&!r.isArray(n)){if(u=Object.keys(n),l=i.map(u,(function(e){return e[0]})),0!==(f=i.filter(l,(function(e){return"$"===e}))).length&&f.length!==l.length)throw new Error("You cannot mix operators and normal fields");if(f.length>0){for(a=0;a<u.length;a+=1){if(!s[u[a]])throw new Error("Unknown comparison function "+u[a]);if(!s[u[a]](h,n[u[a]]))return!1}return!0}}return r.isRegExp(n)?s.$regex(h,n):!!v(h,n)}a.$set=function(e,t,n){e[t]=n},a.$unset=function(e,t,n){delete e[t]},a.$push=function(e,t,n){if(e.hasOwnProperty(t)||(e[t]=[]),!r.isArray(e[t]))throw new Error("Can't $push an element on non-array values");if(null!==n&&"object"==typeof n&&n.$slice&&void 0===n.$each&&(n.$each=[]),null!==n&&"object"==typeof n&&n.$each){if(Object.keys(n).length>=3||2===Object.keys(n).length&&void 0===n.$slice)throw new Error("Can only use $slice in cunjunction with $each when $push to array");if(!r.isArray(n.$each))throw new Error("$each requires an array value");if(n.$each.forEach((function(n){e[t].push(n)})),void 0===n.$slice||"number"!=typeof n.$slice)return;if(0===n.$slice)e[t]=[];else{var i,o,a=e[t].length;n.$slice<0?(i=Math.max(0,a+n.$slice),o=a):n.$slice>0&&(i=0,o=Math.min(a,n.$slice)),e[t]=e[t].slice(i,o)}}else e[t].push(n)},a.$addToSet=function(e,t,n){var i=!0;if(e.hasOwnProperty(t)||(e[t]=[]),!r.isArray(e[t]))throw new Error("Can't $addToSet an element on non-array values");if(null!==n&&"object"==typeof n&&n.$each){if(Object.keys(n).length>1)throw new Error("Can't use another field in conjunction with $each");if(!r.isArray(n.$each))throw new Error("$each requires an array value");n.$each.forEach((function(n){a.$addToSet(e,t,n)}))}else e[t].forEach((function(e){0===g(e,n)&&(i=!1)})),i&&e[t].push(n)},a.$pop=function(e,t,n){if(!r.isArray(e[t]))throw new Error("Can't $pop an element from non-array values");if("number"!=typeof n)throw new Error(n+" isn't an integer, can't use it with $pop");0!==n&&(e[t]=n>0?e[t].slice(0,e[t].length-1):e[t].slice(1))},a.$pull=function(e,t,n){var i,o;if(!r.isArray(e[t]))throw new Error("Can't $pull an element from non-array values");for(o=(i=e[t]).length-1;o>=0;o-=1)k(i[o],n)&&i.splice(o,1)},a.$inc=function(e,t,n){if("number"!=typeof n)throw new Error(n+" must be a number");if("number"!=typeof e[t]){if(i.has(e,t))throw new Error("Don't use the $inc modifier on non-number fields");e[t]=n}else e[t]+=n},a.$max=function(e,t,n){(void 0===e[t]||n>e[t])&&(e[t]=n)},a.$min=function(e,t,n){(void 0===e[t]||n<e[t])&&(e[t]=n)},Object.keys(a).forEach((function(e){o[e]=function(e){return function(t,n,r){var i="string"==typeof n?n.split("."):n;if(1===i.length)a[e](t,n,r);else{if(void 0===t[i[0]]){if("$unset"===e)return;t[i[0]]={}}o[e](t[i[0]],i.slice(1),r)}}}(e)})),s.$lt=function(e,t){return w(e,t)&&e<t},s.$lte=function(e,t){return w(e,t)&&e<=t},s.$gt=function(e,t){return w(e,t)&&e>t},s.$gte=function(e,t){return w(e,t)&&e>=t},s.$ne=function(e,t){return void 0===e||!v(e,t)},s.$in=function(e,t){var n;if(!r.isArray(t))throw new Error("$in operator called with a non-array");for(n=0;n<t.length;n+=1)if(v(e,t[n]))return!0;return!1},s.$nin=function(e,t){if(!r.isArray(t))throw new Error("$nin operator called with a non-array");return!s.$in(e,t)},s.$regex=function(e,t){if(!r.isRegExp(t))throw new Error("$regex operator called with non regular expression");return"string"==typeof e&&t.test(e)},s.$exists=function(e,t){return t=!(!t&&""!==t),void 0===e?!t:t},s.$size=function(e,t){if(!r.isArray(e))return!1;if(t%1!=0)throw new Error("$size operator called without an integer");return e.length==t},s.$elemMatch=function(e,t){if(!r.isArray(e))return!1;for(var n=e.length,i=!1;n--;)if(k(e[n],t)){i=!0;break}return i},c.$size=!0,c.$elemMatch=!0,u.$or=function(e,t){var n;if(!r.isArray(t))throw new Error("$or operator used without an array");for(n=0;n<t.length;n+=1)if(k(e,t[n]))return!0;return!1},u.$and=function(e,t){var n;if(!r.isArray(t))throw new Error("$and operator used without an array");for(n=0;n<t.length;n+=1)if(!k(e,t[n]))return!1;return!0},u.$not=function(e,t){return!k(e,t)},u.$where=function(e,t){var n;if(!i.isFunction(t))throw new Error("$where operator used without a function");if(n=t.call(e),!i.isBoolean(n))throw new Error("$where function must return boolean");return n},e.exports.serialize=function(e){return JSON.stringify(e,(function(e,t){if(l(e,t),void 0!==t)return null===t?null:"function"==typeof this[e].getTime?{$$date:this[e].getTime()}:t}))},e.exports.deserialize=function(e){return JSON.parse(e,(function(e,t){return"$$date"===e?new Date(t):"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t?t:t&&t.$$date?t.$$date:t}))},e.exports.deepCopy=h,e.exports.checkObject=f,e.exports.isPrimitiveType=p,e.exports.modify=function(e,t){var n,r,a=Object.keys(t),s=i.map(a,(function(e){return e[0]})),u=i.filter(s,(function(e){return"$"===e}));if(-1!==a.indexOf("_id")&&t._id!==e._id)throw new Error("You cannot change a document's _id");if(0!==u.length&&u.length!==s.length)throw new Error("You cannot mix modifiers and normal fields");if(0===u.length?(n=h(t))._id=e._id:(r=i.uniq(a),n=h(e),r.forEach((function(e){if(!o[e])throw new Error("Unknown modifier "+e);if("object"!=typeof t[e])throw new Error("Modifier "+e+"'s argument must be an object");Object.keys(t[e]).forEach((function(r){o[e](n,r,t[e][r])}))}))),f(n),e._id!==n._id)throw new Error("You can't change a document's _id");return n},e.exports.getDotValue=y,e.exports.match=k,e.exports.areThingsEqual=v,e.exports.compareThings=g},function(e,t,n){var r;!function(){var n,i,o={};function a(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(n,arguments)}}null!=(n=this)&&(i=n.async),o.noConflict=function(){return n.async=i,o};var s=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},u=function(e,t){if(e.map)return e.map(t);var n=[];return s(e,(function(e,r,i){n.push(t(e,r,i))})),n},c=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};"undefined"!=typeof process&&process.nextTick?(o.nextTick=process.nextTick,"undefined"!=typeof setImmediate?o.setImmediate=function(e){setImmediate(e)}:o.setImmediate=o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(e){setImmediate(e)},o.setImmediate=o.nextTick):(o.nextTick=function(e){setTimeout(e,0)},o.setImmediate=o.nextTick),o.each=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0;s(e,(function(i){t(i,a((function(t){t?(n(t),n=function(){}):(r+=1)>=e.length&&n(null)})))}))},o.forEach=o.each,o.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0,i=function(){t(e[r],(function(t){t?(n(t),n=function(){}):(r+=1)>=e.length?n(null):i()}))};i()},o.forEachSeries=o.eachSeries,o.eachLimit=function(e,t,n,r){l(t).apply(null,[e,n,r])},o.forEachLimit=o.eachLimit;var l=function(e){return function(t,n,r){if(r=r||function(){},!t.length||e<=0)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;a<e&&o<t.length;)a+=1,n(t[(o+=1)-1],(function(e){e?(r(e),r=function(){}):(a-=1,(i+=1)>=t.length?r():s())}))}()}},f=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[o.each].concat(t))}},h=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[o.eachSeries].concat(t))}},p=function(e,t,n,r){var i=[];e(t=u(t,(function(e,t){return{index:t,value:e}})),(function(e,t){n(e.value,(function(n,r){i[e.index]=r,t(n)}))}),(function(e){r(e,i)}))};o.map=f(p),o.mapSeries=h(p),o.mapLimit=function(e,t,n,r){return d(t)(e,n,r)};var d=function(e){return function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[l(e)].concat(n))}}(e,p)};o.reduce=function(e,t,n,r){o.eachSeries(e,(function(e,r){n(t,e,(function(e,n){t=n,r(e)}))}),(function(e){r(e,t)}))},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(e,t,n,r){var i=u(e,(function(e){return e})).reverse();o.reduce(i,t,n,r)},o.foldr=o.reduceRight;var m=function(e,t,n,r){var i=[];e(t=u(t,(function(e,t){return{index:t,value:e}})),(function(e,t){n(e.value,(function(n){n&&i.push(e),t()}))}),(function(e){r(u(i.sort((function(e,t){return e.index-t.index})),(function(e){return e.value})))}))};o.filter=f(m),o.filterSeries=h(m),o.select=o.filter,o.selectSeries=o.filterSeries;var g=function(e,t,n,r){var i=[];e(t=u(t,(function(e,t){return{index:t,value:e}})),(function(e,t){n(e.value,(function(n){n||i.push(e),t()}))}),(function(e){r(u(i.sort((function(e,t){return e.index-t.index})),(function(e){return e.value})))}))};o.reject=f(g),o.rejectSeries=h(g);var y=function(e,t,n,r){e(t,(function(e,t){n(e,(function(n){n?(r(e),r=function(){}):t()}))}),(function(e){r()}))};o.detect=f(y),o.detectSeries=h(y),o.some=function(e,t,n){o.each(e,(function(e,r){t(e,(function(e){e&&(n(!0),n=function(){}),r()}))}),(function(e){n(!1)}))},o.any=o.some,o.every=function(e,t,n){o.each(e,(function(e,r){t(e,(function(e){e||(n(!1),n=function(){}),r()}))}),(function(e){n(!0)}))},o.all=o.every,o.sortBy=function(e,t,n){o.map(e,(function(e,n){t(e,(function(t,r){t?n(t):n(null,{value:e,criteria:r})}))}),(function(e,t){if(e)return n(e);n(null,u(t.sort((function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0})),(function(e){return e.value})))}))},o.auto=function(e,t){t=t||function(){};var n=c(e);if(!n.length)return t(null);var r={},i=[],a=function(e){i.unshift(e)},u=function(){s(i.slice(0),(function(e){e()}))};a((function(){c(r).length===n.length&&(t(null,r),t=function(){})})),s(n,(function(n){var l=e[n]instanceof Function?[e[n]]:e[n],f=function(e){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),e){var a={};s(c(r),(function(e){a[e]=r[e]})),a[n]=i,t(e,a),t=function(){}}else r[n]=i,o.setImmediate(u)},h=l.slice(0,Math.abs(l.length-1))||[],p=function(){return t=function(e,t){return e&&r.hasOwnProperty(t)},i=!0,((e=h).reduce?e.reduce(t,i):(s(e,(function(e,n,r){i=t(i,e,n,r)})),i))&&!r.hasOwnProperty(n);var e,t,i};if(p())l[l.length-1](f,r);else{var d=function(){p()&&(!function(e){for(var t=0;t<i.length;t+=1)if(i[t]===e)return void i.splice(t,1)}(d),l[l.length-1](f,r))};a(d)}}))},o.waterfall=function(e,t){if(t=t||function(){},e.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var r=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),a=e.next();a?i.push(r(a)):i.push(t),o.setImmediate((function(){e.apply(null,i)}))}}};r(o.iterator(e))()};var v=function(e,t,n){if(n=n||function(){},t.constructor===Array)e.map(t,(function(e,t){e&&e((function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)}))}),n);else{var r={};e.each(c(t),(function(e,n){t[e]((function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)}))}),(function(e){n(e,r)}))}};o.parallel=function(e,t){v({map:o.map,each:o.each},e,t)},o.parallelLimit=function(e,t,n){v({map:d(t),each:l(t)},e,n)},o.series=function(e,t){if(t=t||function(){},e.constructor===Array)o.mapSeries(e,(function(e,t){e&&e((function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)}))}),t);else{var n={};o.eachSeries(c(e),(function(t,r){e[t]((function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[t]=i,r(e)}))}),(function(e){t(e,n)}))}},o.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},o.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var w=function(e,t,n,r){var i=[];e(t,(function(e,t){n(e,(function(e,n){i=i.concat(n||[]),t(e)}))}),(function(e){r(e,i)}))};o.concat=f(w),o.concatSeries=h(w),o.whilst=function(e,t,n){e()?t((function(r){if(r)return n(r);o.whilst(e,t,n)})):n()},o.doWhilst=function(e,t,n){e((function(r){if(r)return n(r);t()?o.doWhilst(e,t,n):n()}))},o.until=function(e,t,n){e()?n():t((function(r){if(r)return n(r);o.until(e,t,n)}))},o.doUntil=function(e,t,n){e((function(r){if(r)return n(r);t()?n():o.doUntil(e,t,n)}))},o.queue=function(e,t){function n(e,n,r,i){n.constructor!==Array&&(n=[n]),s(n,(function(n){var a={data:n,callback:"function"==typeof i?i:null};r?e.tasks.unshift(a):e.tasks.push(a),e.saturated&&e.tasks.length===t&&e.saturated(),o.setImmediate(e.process)}))}void 0===t&&(t=1);var r=0,i={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,push:function(e,t){n(i,e,!1,t)},unshift:function(e,t){n(i,e,!0,t)},process:function(){if(r<i.concurrency&&i.tasks.length){var t=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=a((function(){r-=1,t.callback&&t.callback.apply(t,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()}));e(t.data,n)}},length:function(){return i.tasks.length},running:function(){return r}};return i},o.cargo=function(e,t){var n=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),s(e,(function(e){r.push({data:e,callback:"function"==typeof n?n:null}),i.saturated&&r.length===t&&i.saturated()})),o.setImmediate(i.process)},process:function o(){if(!n)if(0!==r.length){var a="number"==typeof t?r.splice(0,t):r.splice(0),c=u(a,(function(e){return e.data}));i.empty&&i.empty(),n=!0,e(c,(function(){n=!1;var e=arguments;s(a,(function(t){t.callback&&t.callback.apply(null,e)})),o()}))}else i.drain&&i.drain()},length:function(){return r.length},running:function(){return n}};return i};var k=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&s(n,(function(t){console[e](t)})))}]))}};o.log=k("log"),o.dir=k("dir"),o.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in n?o.apply(null,n[a]):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([function(){n[a]=arguments;var e=r[a];delete r[a];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},o.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},o.times=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return o.map(r,t,n)},o.timesSeries=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return o.mapSeries(r,t,n)},o.compose=function(){var e=Array.prototype.reverse.call(arguments);return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();o.reduce(e,n,(function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))}),(function(e,n){r.apply(t,[e].concat(n))}))}};var b=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,(function(e,t){e.apply(n,r.concat([t]))}),i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};o.applyEach=f(b),o.applyEachSeries=h(b),o.forever=function(e,t){!function n(r){if(r){if(t)return t(r);throw r}e(n)}()},void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NIM_MODE={language:"nim",scheme:"file"}},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(5),a=n(3),s=n(4),u=n(1);class c{}class l{}var f=[],h={};function p(e,t,n,r){let i=s.join(n,r);var o=new l;if(o.name=r.substr(0,r.length-4),n.length>t.length){let e=n.substr(t.length+1).replace(s.sep,".");o.fullName=e+"."+o.name}else o.fullName=o.name;return o.path=i,o}function d(e,t,n,r){a.readdir(n,(i,o)=>{if(o)for(const i of o){let o=s.join(n,i);a.statSync(o).isDirectory()?r||d(e,t,o,!1):i.toLowerCase().endsWith(".nim")&&h[e].push(p(0,t,n,i))}})}function m(e,t){return r(this,void 0,void 0,(function*(){if(!h[e]){h[e]=[];let n=yield function(e,t){return new Promise((n,r)=>{o.exec(u.getNimExecPath()+" dump "+t,{cwd:e},(e,t,r)=>{var i=[];let o=r.split("\n");for(const e of o){let t=e.trim();0!==t.indexOf("Hint: ")&&t.length>0&&i.push(t)}n(i)})})}(e,t),r=s.dirname(s.dirname(u.getNimExecPath()));for(const t of n)d(e,t,t,t.startsWith(r))}}))}function g(e){return r(this,void 0,void 0,(function*(){let t=yield function(e){return new Promise((t,n)=>{o.exec(u.getNimbleExecPath()+" list -i",{cwd:e},(e,n,r)=>{var i=[];let o=n.split("\n");for(const e of o){let t=e.split("[")[0].trim();t.length>0&&"compiler"!==t&&i.push(t)}t(i)})})}(e);for(const r of t)try{let t=o.execSync(u.getNimbleExecPath()+" --y dump "+r,{cwd:e}).toString();var n=new c;n.name=r;for(const e of t.split(/\n/)){let t=e.trim().split(': "');if(2===t.length){let e=t[1].substring(0,t[1].length-1);"author"===t[0]?n.author=e:"version"===t[0]?n.version=e:"desc"===t[0]&&(n.description=e)}}f.push(n)}catch(e){console.log("Module incorrect "+r)}}))}t.getImports=function(e,t){var n=[];for(const t of f){if(!e||t.name.startsWith(e)){var r=new i.CompletionItem(t.name);r.kind=i.CompletionItemKind.Module,t.version?r.detail=t.name+" ["+t.version+"]":r.detail=t.name,r.detail+=" (Nimble)";var o="**Name**: "+t.name;t.version&&(o+="\n\n**Version**: "+t.version),t.author&&(o+="\n\n**Author**: "+t.author),t.description&&(o+="\n\n**Description**: "+t.description),r.documentation=new i.MarkdownString(o),n.push(r)}if(n.length>=20)return n}if(h[t])for(const r of h[t]){if(!e||r.name.startsWith(e)){var a=new i.CompletionItem(r.name);a.kind=i.CompletionItemKind.Module,a.insertText=r.fullName,a.detail=r.fullName,a.documentation=r.path,n.push(a)}if(n.length>=100)return n}return n},t.initImports=function(){return r(this,void 0,void 0,(function*(){if(i.workspace.workspaceFolders&&(yield yield g(i.workspace.workspaceFolders[0].uri.fsPath)),u.isProjectMode())for(const e of u.getProjects())yield m(e.wsFolder.uri.fsPath,e.filePath);else i.workspace.workspaceFolders&&(yield m(i.workspace.workspaceFolders[0].uri.fsPath,""))}))},t.addFileToImports=function(e){return r(this,void 0,void 0,(function*(){if(u.isProjectMode())for(const t of u.getProjects()){let n=t.wsFolder.uri.fsPath;e.startsWith(n)&&(h[n]||(h[n]=[]),h[n].push(p(0,n,s.dirname(e),s.basename(e))))}else if(i.workspace.workspaceFolders){let t=i.workspace.workspaceFolders[0].uri.fsPath;h[t]||(h[t]=[]),h[t].push(p(0,t,s.dirname(e),s.basename(e)))}}))},t.removeFileFromImports=function(e){return r(this,void 0,void 0,(function*(){for(const n in h){const r=h[n];for(var t=0;t<r.length;)r[t].path===e?r.splice(t):t++}}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),o=n(30),a=n(4),s=n(3),u=n(2),c=n(18);var l,f;function h(e,t){return new Promise((n,r)=>{u.execNimSuggest(u.NimSuggestType.outline,e,0,0,t).then(e=>{var t=[],r=[];e&&e.forEach(e=>{if(("skLet"!==e.suggest&&"skVar"!==e.suggest||!(e.containerName.indexOf(".")>0))&&-1===r.indexOf(e.column+":"+e.line)){r.push(e.column+":"+e.line);let n=new i.SymbolInformation(e.symbolName,function(e){switch(e){case"skConst":return i.SymbolKind.Constant;case"skEnumField":return i.SymbolKind.Enum;case"skForVar":return i.SymbolKind.Variable;case"skIterator":return i.SymbolKind.Array;case"skLabel":return i.SymbolKind.String;case"skLet":return i.SymbolKind.Variable;case"skMacro":return i.SymbolKind.Function;case"skMethod":return i.SymbolKind.Method;case"skParam":return i.SymbolKind.Variable;case"skProc":case"skResult":return i.SymbolKind.Function;case"skTemplate":return i.SymbolKind.Interface;case"skType":return i.SymbolKind.Class;case"skVar":return i.SymbolKind.Variable;case"skFunc":return i.SymbolKind.Function}return i.SymbolKind.Property}(e.suggest),e.range,e.uri,e.containerName);t.push(n)}}),n(t)}).catch(e=>r(e))})}function p(e){return r(this,void 0,void 0,(function*(){let t=s.statSync(e).mtime.getTime();if(!(yield function(e,t){return r(this,void 0,void 0,(function*(){return new Promise((n,r)=>{l.findOne({file:e,timestamp:t},(function(e,t){n(t)}))})}))}(e,t))){let n=yield h(e,"");n&&n.length>0&&(l.remove({file:e},{multi:!0},(n,r)=>{l.insert({file:e,timestamp:t})}),f.remove({file:e},{multi:!0},(e,t)=>{n.forEach(e=>{f.insert({ws:i.workspace.rootPath,file:e.location.uri.fsPath,range_start:e.location.range.start,range_end:e.location.range.end,type:e.name,container:e.containerName,kind:e.kind})})}))}}))}function d(e,t){let n=a.join(e,t+".db");s.existsSync(n)&&s.unlinkSync(n);for(var r=0;r<4;++r){let n=a.join(e,m(t,r));s.existsSync(n)&&s.unlinkSync(n)}}function m(e,t){return`${e}_${t}.db`}t.addWorkspaceFile=function(e){p(e)},t.removeWorkspaceFile=function(e){!function(e){l.remove({file:e},{multi:!0},(function(t,n){f.remove({file:e},{multi:!0})}))}(e)},t.changeWorkspaceFile=function(e){p(e)},t.initWorkspace=function(e){return r(this,void 0,void 0,(function*(){if(d(e,"files"),d(e,"types"),(f=new o({filename:a.join(e,m("types",4)),autoload:!0})).persistence.setAutocompactionInterval(6e5),f.ensureIndex({fieldName:"workspace"}),f.ensureIndex({fieldName:"file"}),f.ensureIndex({fieldName:"timestamp"}),f.ensureIndex({fieldName:"type"}),(l=new o({filename:a.join(e,m("files",4)),autoload:!0})).persistence.setAutocompactionInterval(6e5),l.ensureIndex({fieldName:"file"}),l.ensureIndex({fieldName:"timestamp"}),!u.getNimSuggestPath())return;let t=yield i.workspace.findFiles("**/*.nim","");c.showNimProgress("Indexing: "+t.length);for(var n=0;n<t.length;n++){let e=t[n].fsPath,r=t.length-n;r%10==0&&c.updateNimProgress(`Indexing: ${r} of ${t.length}`),yield p(e)}c.hideNimProgress()}))},t.findWorkspaceSymbols=function(e){return new Promise((t,n)=>{try{let n=new RegExp(e,"i");f.find({ws:i.workspace.rootPath,type:n}).limit(100).exec((e,n)=>{let r=[];n.forEach(e=>{r.push(new i.SymbolInformation(e.type,e.kind,new i.Range(new i.Position(e.range_start._line,e.range_start._character),new i.Position(e.range_end._line,e.range_end._character)),i.Uri.file(e.file),e.container))}),t(r)})}catch(e){t([])}})},t.getFileSymbols=h},function(e,t,n){var r=n(32);e.exports.uid=function(e){return r.randomBytes(Math.ceil(Math.max(8,2*e))).toString("base64").replace(/[+\/]/g,"").slice(0,e)}},function(e,t,n){var r=n(34).AVLTree,i=n(8),o=n(7),a=n(6);function s(e,t){return e===t}function u(e){return null===e?"$null":"string"==typeof e?"$string"+e:"boolean"==typeof e?"$boolean"+e:"number"==typeof e?"$number"+e:a.isArray(e)?"$date"+e.getTime():e}function c(e){this.fieldName=e.fieldName,this.unique=e.unique||!1,this.sparse=e.sparse||!1,this.treeOptions={unique:this.unique,compareKeys:i.compareThings,checkValueEquality:s},this.reset()}c.prototype.reset=function(e){this.tree=new r(this.treeOptions),e&&this.insert(e)},c.prototype.insert=function(e){var t,n,r,s,c;if(a.isArray(e))this.insertMultipleDocs(e);else if(void 0!==(t=i.getDotValue(e,this.fieldName))||!this.sparse)if(a.isArray(t)){for(n=o.uniq(t,u),r=0;r<n.length;r+=1)try{this.tree.insert(n[r],e)}catch(e){c=e,s=r;break}if(c){for(r=0;r<s;r+=1)this.tree.delete(n[r],e);throw c}}else this.tree.insert(t,e)},c.prototype.insertMultipleDocs=function(e){var t,n,r;for(t=0;t<e.length;t+=1)try{this.insert(e[t])}catch(e){n=e,r=t;break}if(n){for(t=0;t<r;t+=1)this.remove(e[t]);throw n}},c.prototype.remove=function(e){var t,n=this;a.isArray(e)?e.forEach((function(e){n.remove(e)})):void 0===(t=i.getDotValue(e,this.fieldName))&&this.sparse||(a.isArray(t)?o.uniq(t,u).forEach((function(t){n.tree.delete(t,e)})):this.tree.delete(t,e))},c.prototype.update=function(e,t){if(a.isArray(e))this.updateMultipleDocs(e);else{this.remove(e);try{this.insert(t)}catch(t){throw this.insert(e),t}}},c.prototype.updateMultipleDocs=function(e){var t,n,r;for(t=0;t<e.length;t+=1)this.remove(e[t].oldDoc);for(t=0;t<e.length;t+=1)try{this.insert(e[t].newDoc)}catch(e){r=e,n=t;break}if(r){for(t=0;t<n;t+=1)this.remove(e[t].newDoc);for(t=0;t<e.length;t+=1)this.insert(e[t].oldDoc);throw r}},c.prototype.revertUpdate=function(e,t){var n=[];a.isArray(e)?(e.forEach((function(e){n.push({oldDoc:e.newDoc,newDoc:e.oldDoc})})),this.update(n)):this.update(t,e)},c.prototype.getMatching=function(e){var t=this;if(a.isArray(e)){var n={},r=[];return e.forEach((function(e){t.getMatching(e).forEach((function(e){n[e._id]=e}))})),Object.keys(n).forEach((function(e){r.push(n[e])})),r}return t.tree.search(e)},c.prototype.getBetweenBounds=function(e){return this.tree.betweenBounds(e)},c.prototype.getAll=function(){var e=[];return this.tree.executeOnEveryNode((function(t){var n;for(n=0;n<t.data.length;n+=1)e.push(t.data[n])})),e},e.exports=c},function(e,t,n){var r=n(17);function i(e){e=e||{},this.left=null,this.right=null,this.parent=void 0!==e.parent?e.parent:null,e.hasOwnProperty("key")&&(this.key=e.key),this.data=e.hasOwnProperty("value")?[e.value]:[],this.unique=e.unique||!1,this.compareKeys=e.compareKeys||r.defaultCompareKeysFunction,this.checkValueEquality=e.checkValueEquality||r.defaultCheckValueEquality}function o(e,t){var n;for(n=0;n<t.length;n+=1)e.push(t[n])}i.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this},i.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key},i.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this},i.prototype.getMinKey=function(){return this.getMinKeyDescendant().key},i.prototype.checkAllNodesFullfillCondition=function(e){this.hasOwnProperty("key")&&(e(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(e),this.right&&this.right.checkAllNodesFullfillCondition(e))},i.prototype.checkNodeOrdering=function(){var e=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition((function(t){if(e.compareKeys(t,e.key)>=0)throw new Error("Tree with root "+e.key+" is not a binary search tree")})),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition((function(t){if(e.compareKeys(t,e.key)<=0)throw new Error("Tree with root "+e.key+" is not a binary search tree")})),this.right.checkNodeOrdering()))},i.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.right.checkInternalPointers()}},i.prototype.checkIsBST=function(){if(this.checkNodeOrdering(),this.checkInternalPointers(),this.parent)throw new Error("The root shouldn't have a parent")},i.prototype.getNumberOfKeys=function(){var e;return this.hasOwnProperty("key")?(e=1,this.left&&(e+=this.left.getNumberOfKeys()),this.right&&(e+=this.right.getNumberOfKeys()),e):0},i.prototype.createSimilar=function(e){return(e=e||{}).unique=this.unique,e.compareKeys=this.compareKeys,e.checkValueEquality=this.checkValueEquality,new this.constructor(e)},i.prototype.createLeftChild=function(e){var t=this.createSimilar(e);return t.parent=this,this.left=t,t},i.prototype.createRightChild=function(e){var t=this.createSimilar(e);return t.parent=this,this.right=t,t},i.prototype.insert=function(e,t){if(!this.hasOwnProperty("key"))return this.key=e,void this.data.push(t);if(0!==this.compareKeys(this.key,e))this.compareKeys(e,this.key)<0?this.left?this.left.insert(e,t):this.createLeftChild({key:e,value:t}):this.right?this.right.insert(e,t):this.createRightChild({key:e,value:t});else{if(this.unique){var n=new Error("Can't insert key "+e+", it violates the unique constraint");throw n.key=e,n.errorType="uniqueViolated",n}this.data.push(t)}},i.prototype.search=function(e){return this.hasOwnProperty("key")?0===this.compareKeys(this.key,e)?this.data:this.compareKeys(e,this.key)<0?this.left?this.left.search(e):[]:this.right?this.right.search(e):[]:[]},i.prototype.getLowerBoundMatcher=function(e){var t=this;return e.hasOwnProperty("$gt")||e.hasOwnProperty("$gte")?e.hasOwnProperty("$gt")&&e.hasOwnProperty("$gte")?0===t.compareKeys(e.$gte,e.$gt)?function(n){return t.compareKeys(n,e.$gt)>0}:t.compareKeys(e.$gte,e.$gt)>0?function(n){return t.compareKeys(n,e.$gte)>=0}:function(n){return t.compareKeys(n,e.$gt)>0}:e.hasOwnProperty("$gt")?function(n){return t.compareKeys(n,e.$gt)>0}:function(n){return t.compareKeys(n,e.$gte)>=0}:function(){return!0}},i.prototype.getUpperBoundMatcher=function(e){var t=this;return e.hasOwnProperty("$lt")||e.hasOwnProperty("$lte")?e.hasOwnProperty("$lt")&&e.hasOwnProperty("$lte")?0===t.compareKeys(e.$lte,e.$lt)?function(n){return t.compareKeys(n,e.$lt)<0}:t.compareKeys(e.$lte,e.$lt)<0?function(n){return t.compareKeys(n,e.$lte)<=0}:function(n){return t.compareKeys(n,e.$lt)<0}:e.hasOwnProperty("$lt")?function(n){return t.compareKeys(n,e.$lt)<0}:function(n){return t.compareKeys(n,e.$lte)<=0}:function(){return!0}},i.prototype.betweenBounds=function(e,t,n){var r=[];return this.hasOwnProperty("key")?(t=t||this.getLowerBoundMatcher(e),n=n||this.getUpperBoundMatcher(e),t(this.key)&&this.left&&o(r,this.left.betweenBounds(e,t,n)),t(this.key)&&n(this.key)&&o(r,this.data),n(this.key)&&this.right&&o(r,this.right.betweenBounds(e,t,n)),r):[]},i.prototype.deleteIfLeaf=function(){return!this.left&&!this.right&&(this.parent?(this.parent.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0))},i.prototype.deleteIfOnlyOneChild=function(){var e;return this.left&&!this.right&&(e=this.left),!this.left&&this.right&&(e=this.right),!!e&&(this.parent?(this.parent.left===this?(this.parent.left=e,e.parent=this.parent):(this.parent.right=e,e.parent=this.parent),!0):(this.key=e.key,this.data=e.data,this.left=null,e.left&&(this.left=e.left,e.left.parent=this),this.right=null,e.right&&(this.right=e.right,e.right.parent=this),!0))},i.prototype.delete=function(e,t){var n,r=[],i=this;if(this.hasOwnProperty("key"))if(this.compareKeys(e,this.key)<0)this.left&&this.left.delete(e,t);else if(this.compareKeys(e,this.key)>0)this.right&&this.right.delete(e,t);else if(0!==!this.compareKeys(e,this.key))return this.data.length>1&&void 0!==t?(this.data.forEach((function(e){i.checkValueEquality(e,t)||r.push(e)})),void(i.data=r)):void(this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(Math.random()>=.5?(n=this.left.getMaxKeyDescendant(),this.key=n.key,this.data=n.data,this===n.parent?(this.left=n.left,n.left&&(n.left.parent=n.parent)):(n.parent.right=n.left,n.left&&(n.left.parent=n.parent))):(n=this.right.getMinKeyDescendant(),this.key=n.key,this.data=n.data,this===n.parent?(this.right=n.right,n.right&&(n.right.parent=n.parent)):(n.parent.left=n.right,n.right&&(n.right.parent=n.parent)))))},i.prototype.executeOnEveryNode=function(e){this.left&&this.left.executeOnEveryNode(e),e(this),this.right&&this.right.executeOnEveryNode(e)},i.prototype.prettyPrint=function(e,t){t=t||"",console.log(t+"* "+this.key),e&&console.log(t+"* "+this.data),(this.left||this.right)&&(this.left?this.left.prettyPrint(e,t+"  "):console.log(t+"  *"),this.right?this.right.prettyPrint(e,t+"  "):console.log(t+"  *"))},e.exports=i},function(e,t){e.exports.getRandomArray=function e(t){var n,r;return 0===t?[]:1===t?[0]:(n=e(t-1),r=Math.floor(Math.random()*t),n.splice(r,0,t-1),n)},e.exports.defaultCompareKeysFunction=function(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;var n=new Error("Couldn't compare elements");throw n.a=e,n.b=t,n},e.exports.defaultCheckValueEquality=function(e,t){return e===t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(10),i=n(0);let o,a;t.showHideStatus=function(){o&&(i.window.activeTextEditor&&i.languages.match(r.NIM_MODE,i.window.activeTextEditor.document)?o.show():o.hide())},t.hideNimStatus=function(){o.dispose()},t.hideNimProgress=function(){a.dispose()},t.showNimStatus=function(e,t,n){o=i.window.createStatusBarItem(i.StatusBarAlignment.Right,Number.MIN_VALUE),o.text=e,o.command=t,o.color="yellow",o.tooltip=n,o.show()},t.showNimProgress=function(e){a=i.window.createStatusBarItem(i.StatusBarAlignment.Right,Number.MIN_VALUE),console.log(e),a.text=e,a.tooltip=e,a.show()},t.updateNimProgress=function(e){a.text=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(3),o=n(4),a=n(2),s=n(24),u=n(25),c=n(26),l=n(27),f=n(28),h=n(29),p=n(13),d=n(41),m=n(42),g=n(43),y=n(10),v=n(18),w=n(1),k=n(0),b=n(12);let x;var P,E;function S(e){let t=r.workspace.getConfiguration("nim");if(!e&&r.window.activeTextEditor&&(e=r.window.activeTextEditor.document),e&&"nim"===e.languageId&&!e.fileName.endsWith("nim.cfg")){var n=e.uri;r.window.withProgress({location:k.ProgressLocation.Window,cancellable:!1,title:"Nim: check project..."},e=>g.check(n.fsPath,t)).then(e=>{x.clear();let t=new Map;var n={};e.forEach(e=>{if(!n[e.file+e.line+e.column+e.msg]){let i=e.file,o=e.column;e.msg.indexOf("'")>=0&&(o+=e.msg.lastIndexOf("'")-e.msg.indexOf("'")-2);let a=Math.max(0,e.line-1),s=new r.Range(a,Math.max(0,e.column-1),a,Math.max(0,o)),u=new r.Diagnostic(s,e.msg,function(e){switch(e){case"Hint":return r.DiagnosticSeverity.Warning;case"Error":return r.DiagnosticSeverity.Error;case"Warning":return r.DiagnosticSeverity.Warning;default:return r.DiagnosticSeverity.Error}}(e.severity)),c=t.get(i);c||(c=[]),t.set(i,c),c.push(u),n[e.file+e.line+e.column+e.msg]=!0}});let i=[];t.forEach((e,t)=>{i.push([r.Uri.file(t),e])}),x.set(i)})}}function N(){let e=r.window.activeTextEditor;if(e)if(E||(E=r.window.createTerminal("Nim")),E.show(!0),e.document.isUntitled)E.sendText("nim "+r.workspace.getConfiguration("nim").buildCommand+' -r "'+w.getDirtyFile(e.document)+'"',!0);else{let a=r.workspace.getConfiguration("nim").runOutputDirectory;var t="";if(a&&r.workspace.workspaceFolders){var n="";for(const e of r.workspace.workspaceFolders)if("file"===e.uri.scheme){n=e.uri.fsPath;break}""!==n&&(i.existsSync(o.join(n,a))||i.mkdirSync(o.join(n,a)),t=' --out:"'+o.join(a,o.basename(e.document.fileName,".nim"))+'"')}e&&e.document.isDirty?e.document.save().then(n=>{E&&e&&n&&E.sendText("nim "+r.workspace.getConfiguration("nim").buildCommand+t+' -r "'+e.document.fileName+'"',!0)}):E.sendText("nim "+r.workspace.getConfiguration("nim").buildCommand+t+' -r "'+e.document.fileName+'"',!0)}}t.activate=function(e){let t=r.workspace.getConfiguration("nim");var n;if(r.commands.registerCommand("nim.run.file",N),r.commands.registerCommand("nim.check",S),r.commands.registerCommand("nim.execSelectionInTerminal",g.execSelectionInTerminal),r.workspace.getConfiguration("nim").get("enableNimsuggest")&&(a.initNimSuggest(),e.subscriptions.push(r.languages.registerCompletionItemProvider(y.NIM_MODE,new s.NimCompletionItemProvider,"."," ")),e.subscriptions.push(r.languages.registerDefinitionProvider(y.NIM_MODE,new u.NimDefinitionProvider)),e.subscriptions.push(r.languages.registerReferenceProvider(y.NIM_MODE,new c.NimReferenceProvider)),e.subscriptions.push(r.languages.registerRenameProvider(y.NIM_MODE,new f.NimRenameProvider)),e.subscriptions.push(r.languages.registerDocumentSymbolProvider(y.NIM_MODE,new h.NimDocumentSymbolProvider)),e.subscriptions.push(r.languages.registerSignatureHelpProvider(y.NIM_MODE,new d.NimSignatureHelpProvider,"(",",")),e.subscriptions.push(r.languages.registerHoverProvider(y.NIM_MODE,new l.NimHoverProvider)),e.subscriptions.push(r.languages.registerDocumentFormattingEditProvider(y.NIM_MODE,new m.NimFormattingProvider))),x=r.languages.createDiagnosticCollection("nim"),e.subscriptions.push(x),r.languages.setLanguageConfiguration(y.NIM_MODE.language,{onEnterRules:[{beforeText:/^(\s)*## /,action:{indentAction:r.IndentAction.None,appendText:"## "}},{beforeText:new RegExp(String.raw`
                    ^\s*
                    (
                        (case) \b .* :
                    )
                    \s*$
                `.replace(/\s+?/g,"")),action:{indentAction:r.IndentAction.None}},{beforeText:new RegExp(String.raw`
                    ^\s*
                    (
                        (
                            (proc|macro|iterator|template|converter|func) \b .*=
                        )|(
                            (import|export|let|var|const|type) \b
                        )|(
                            [^:]+:
                        )
                    )
                    \s*$
                `.replace(/\s+?/g,"")),action:{indentAction:r.IndentAction.Indent}},{beforeText:new RegExp(String.raw`
                ^\s*
                    (
                        (
                            (return|raise|break|continue) \b .*
                        )|(
                            (discard) \b
                        )
                    )
                    \s*
                `.replace(/\s+?/g,"")),action:{indentAction:r.IndentAction.Outdent}}],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g}),r.window.onDidChangeActiveTextEditor(v.showHideStatus,null,e.subscriptions),r.window.onDidCloseTerminal(e=>{E&&e.processId===E.processId&&(E=void 0)}),console.log(e.extensionPath),g.activateEvalConsole(),p.initWorkspace(e.extensionPath),(P=r.workspace.createFileSystemWatcher("**/*.nim")).onDidCreate(e=>{if(t.has("licenseString")){let n=e.fsPath.toLowerCase();(n.endsWith(".nim")||n.endsWith(".nims"))&&i.stat(e.fsPath,(n,i)=>{if(i&&0===i.size){let n=new r.WorkspaceEdit;n.insert(e,new r.Position(0,0),t.licenseString),r.workspace.applyEdit(n)}})}b.addFileToImports(e.fsPath)}),P.onDidDelete(e=>{b.removeFileFromImports(e.fsPath)}),e.subscriptions.push(r.languages.registerWorkspaceSymbolProvider(new h.NimWorkspaceSymbolProvider)),n=e.subscriptions,r.workspace.onDidSaveTextDocument(e=>{"nim"===e.languageId&&(r.workspace.getConfiguration("nim").lintOnSave&&S(e),r.workspace.getConfiguration("nim").buildOnSave&&r.commands.executeCommand("workbench.action.tasks.build"))},null,n),r.window.activeTextEditor&&r.workspace.getConfiguration("nim").lintOnSave&&S(r.window.activeTextEditor.document),r.workspace.getConfiguration("nim").get("enableNimsuggest")&&t.has("nimsuggestRestartTimeout")){let e=t.nimsuggestRestartTimeout;e>0&&(console.log("Reset nimsuggest process each "+e+" minutes"),global.setInterval(()=>a.closeAllNimSuggestProcesses(),6e4*e))}b.initImports(),w.outputLine("[info] Extension Activated")},t.deactivate=function(){a.closeAllNimSuggestProcesses(),P.dispose()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(21),i=n(6),o=n(22);class a{constructor(e){this.sessions=new Map,this.socketClosed=!1,this.socket=e,this.receivedBuffer=new Buffer(0),this.socket.on("data",e=>{for(this.receivedBuffer=Buffer.concat([this.receivedBuffer,e]);this.receivedBuffer.length>0;)if(this.receivedBuffer.length>=6){let e=parseInt(this.receivedBuffer.toString("utf8",0,6),16);if(!(this.receivedBuffer.length>=e+6))return;{let t=o.parseSExp(this.receivedBuffer.toString("utf8",6,6+e));if(t){let e=t[0][1];this.sessions.get(e)(t[0]),this.sessions.delete(e)}else this.sessions.forEach(e=>{e("Received invalid SExp data")});this.receivedBuffer=this.receivedBuffer.slice(6+e)}}}),this.socket.on("close",e=>{console.error("Connection closed"+(e?" due to an error":"")),this.sessions.forEach(e=>{e("Connection closed")}),this.socketClosed=!0})}callMethod(e,...t){return new Promise((n,r)=>{this.socketClosed&&r("Connection closed");let a=Math.floor(1e4*Math.random()),s="(call "+a+" "+e+" "+o.toString({kind:"list",elements:t})+")";var u;this.sessions.set(a,e=>{if(e instanceof Array)switch(e[0]){case"return":n(e[2]);break;case"return-error":case"epc-error":r(e[2])}else r(e)}),this.socket.write((u=s,("000000"+(new i.TextEncoder).encode(u).length.toString(16)).slice(-6)+u))})}stop(){this.socketClosed||this.socket.destroy()}}t.EPCPeer=a,t.startClient=function(e){return new Promise((t,n)=>{try{let n=r.createConnection(e,"localhost",()=>{t(new a(n))})}catch(e){n(e)}})}},function(e,t){e.exports=require("net")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJS=function e(t){switch(t.kind){case"cons":return[e(t.car),e(t.cdr)];case"list":return t.elements.map(t=>e(t));case"number":return t.n;case"ident":return t.ident;case"string":return t.str;case"nil":return null}},t.toString=function e(t){switch(t.kind){case"cons":return"("+e(t.car)+" . "+e(t.cdr)+")";case"list":let n="(";return t.elements.forEach(t=>{n+=e(t)+" "}),n.substr(0,n.length-1)+")";case"number":return t.n.toString();case"ident":return t.ident;case"string":return JSON.stringify(t.str);case"nil":return"nil"}},t.parseSExp=function(e){let t=0;function n(){let n=t;for(;t<e.length&&" "!==e[t]&&")"!==e[t];)"\\"===e[t]&&" "===e[t+1]?t+=2:t++;let r=e.substring(n,t);return/^-?\d+$/.test(r)?parseInt(r):"nil"===r?null:r}function r(){let n=!1,r=t;for(;t<e.length&&'"'!==e[t];)if("\\"===e[t]){if(t+1>=e.length)throw"Expected character after a escape seqence introducing backslash";t+=2,n=!0}else t++;return n?JSON.parse(e.substring(r-1,t+1)):e.substring(r,t)}try{return function i(o){let a=[],s=!1;for(;t<e.length;){if("("!==e[t]&&")"!==e[t]&&" "!==e[t]&&'"'!==e[t]){let e=n();if("."===e){if(1!==a.length)throw"Invalid cons cell syntax";s=!0}a.push(e)}else"("===e[t]?(t++,a.push(i())):'"'===e[t]&&(t++,a.push(r()));if(")"===e[t++])break}if(")"!==e[t-1]&&!o)throw"Premature end, expected closing bracket";if(s){if(3===a.length)return[a[0],a[2]];throw"Invalid cons cell syntax"}return a}(!0)}catch(e){return e}}},function(e,t){e.exports=require("readline")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(2),a=n(12);t.NimCompletionItemProvider=class{provideCompletionItems(e,t,n){return new Promise((n,s)=>{var u=e.fileName;let c=e.getWordRangeAtPosition(t),l=c?e.getText(c).toLowerCase():void 0;if(e.lineAt(t).text.startsWith("import ")){let r=l&&c?e.getText(c.with({end:t})).toLowerCase():void 0;n(a.getImports(r,i.getProjectFileInfo(u).wsFolder.uri.fsPath))}else o.execNimSuggest(o.NimSuggestType.sug,u,t.line+1,t.character,i.getDirtyFile(e)).then(e=>{var t=[];e&&e.forEach(e=>{if("sug"===e.answerType&&(!l||e.symbolName.toLowerCase().indexOf(l)>=0)&&/[a-z]/i.test(e.symbolName)){var n=new r.CompletionItem(e.symbolName);n.kind=function(e){switch(e){case"skConst":return r.CompletionItemKind.Value;case"skEnumField":return r.CompletionItemKind.Enum;case"skForVar":return r.CompletionItemKind.Variable;case"skIterator":case"skLabel":return r.CompletionItemKind.Keyword;case"skLet":return r.CompletionItemKind.Value;case"skMacro":return r.CompletionItemKind.Snippet;case"skMethod":return r.CompletionItemKind.Method;case"skParam":return r.CompletionItemKind.Variable;case"skProc":return r.CompletionItemKind.Function;case"skResult":return r.CompletionItemKind.Value;case"skTemplate":return r.CompletionItemKind.Snippet;case"skType":return r.CompletionItemKind.Class;case"skVar":return r.CompletionItemKind.Field;case"skFunc":return r.CompletionItemKind.Function}return r.CompletionItemKind.Property}(e.suggest),n.detail=function(e){switch(e.suggest){case"skConst":return"const "+e.fullName+": "+e.type;case"skEnumField":return"enum "+e.type;case"skForVar":return"for var of "+e.type;case"skIterator":return e.type;case"skLabel":return"label";case"skLet":return"let of "+e.type;case"skMacro":return"macro";case"skMethod":return e.type;case"skParam":return"param";case"skProc":return e.type;case"skResult":return"result";case"skTemplate":return e.type;case"skType":return"type "+e.fullName;case"skVar":return"var of "+e.type}return e.type}(e),n.sortText=("0000"+t.length).slice(-4),n.documentation=new r.MarkdownString(e.documentation),t.push(n)}}),t.length>0?n(t):s()}).catch(e=>s(e))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(2);t.NimDefinitionProvider=class{provideDefinition(e,t,n){return new Promise((n,o)=>{i.execNimSuggest(i.NimSuggestType.def,e.fileName,t.line+1,t.character,r.getDirtyFile(e)).then(e=>{if(e&&e.length>0){let t=e.pop();n(t?t.location:null)}else n(null)}).catch(e=>o(e))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(2);t.NimReferenceProvider=class{provideReferences(e,t,n,a){return new Promise((n,a)=>{r.workspace.saveAll(!1).then(()=>{o.execNimSuggest(o.NimSuggestType.use,e.fileName,t.line+1,t.character,i.getDirtyFile(e)).then(e=>{var t=[];e?(e.forEach(e=>{t.push(e.location)}),n(t)):n()}).catch(e=>a(e))})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(10),o=n(1),a=n(2);t.NimHoverProvider=class{provideHover(e,t,n){return new Promise((n,s)=>{a.execNimSuggest(a.NimSuggestType.def,e.fileName,t.line+1,t.character,o.getDirtyFile(e)).then(e=>{if(e&&e.length>0){let t=e.pop(),o=t.fullName;""!==t.type&&(o+=": "+t.type);let a={language:i.NIM_MODE.language,value:o};""!==t.documentation?n(new r.Hover([a,t.documentation])):n(new r.Hover(a))}else n()}).catch(e=>s(e))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(2);t.NimRenameProvider=class{provideRenameEdits(e,t,n,a){return new Promise((a,s)=>{r.workspace.saveAll(!1).then(()=>{o.execNimSuggest(o.NimSuggestType.use,e.fileName,t.line+1,t.character,i.getDirtyFile(e)).then(e=>{var t=new r.WorkspaceEdit;e?(e.forEach(e=>{let i=new r.Position(e.range.end.line,e.range.end.character+e.symbolName.length);t.replace(e.uri,new r.Range(e.range.start,i),n)}),a(t)):a()}).catch(e=>s(e))})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(13);t.NimWorkspaceSymbolProvider=class{provideWorkspaceSymbols(e,t){return i.findWorkspaceSymbols(e)}};t.NimDocumentSymbolProvider=class{provideDocumentSymbols(e,t){return i.getFileSymbols(e.fileName,r.getDirtyFile(e))}}},function(e,t,n){var r=n(31);e.exports=r},function(e,t,n){var r=n(14),i=n(8),o=n(9),a=n(33),s=n(15),u=n(6),c=n(7),l=n(36),f=n(39);function h(e){var t;"string"==typeof e?(t=e,this.inMemoryOnly=!1):(t=(e=e||{}).filename,this.inMemoryOnly=e.inMemoryOnly||!1,this.autoload=e.autoload||!1,this.timestampData=e.timestampData||!1),t&&"string"==typeof t&&0!==t.length?this.filename=t:(this.filename=null,this.inMemoryOnly=!0),this.compareStrings=e.compareStrings,this.persistence=new l({db:this,nodeWebkitAppName:e.nodeWebkitAppName,afterSerialization:e.afterSerialization,beforeDeserialization:e.beforeDeserialization,corruptAlertThreshold:e.corruptAlertThreshold}),this.executor=new a,this.inMemoryOnly&&(this.executor.ready=!0),this.indexes={},this.indexes._id=new s({fieldName:"_id",unique:!0}),this.ttlIndexes={},this.autoload&&this.loadDatabase(e.onload||function(e){if(e)throw e})}u.inherits(h,n(40).EventEmitter),h.prototype.loadDatabase=function(){this.executor.push({this:this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)},h.prototype.getAllData=function(){return this.indexes._id.getAll()},h.prototype.resetIndexes=function(e){var t=this;Object.keys(this.indexes).forEach((function(n){t.indexes[n].reset(e)}))},h.prototype.ensureIndex=function(e,t){var n,r=t||function(){};if(!(e=e||{}).fieldName)return(n=new Error("Cannot create an index without a fieldName")).missingFieldName=!0,r(n);if(this.indexes[e.fieldName])return r(null);this.indexes[e.fieldName]=new s(e),void 0!==e.expireAfterSeconds&&(this.ttlIndexes[e.fieldName]=e.expireAfterSeconds);try{this.indexes[e.fieldName].insert(this.getAllData())}catch(t){return delete this.indexes[e.fieldName],r(t)}this.persistence.persistNewState([{$$indexCreated:e}],(function(e){return r(e||null)}))},h.prototype.removeIndex=function(e,t){var n=t||function(){};delete this.indexes[e],this.persistence.persistNewState([{$$indexRemoved:e}],(function(e){return n(e||null)}))},h.prototype.addToIndexes=function(e){var t,n,r,i=Object.keys(this.indexes);for(t=0;t<i.length;t+=1)try{this.indexes[i[t]].insert(e)}catch(e){n=t,r=e;break}if(r){for(t=0;t<n;t+=1)this.indexes[i[t]].remove(e);throw r}},h.prototype.removeFromIndexes=function(e){var t=this;Object.keys(this.indexes).forEach((function(n){t.indexes[n].remove(e)}))},h.prototype.updateIndexes=function(e,t){var n,r,i,o=Object.keys(this.indexes);for(n=0;n<o.length;n+=1)try{this.indexes[o[n]].update(e,t)}catch(e){r=n,i=e;break}if(i){for(n=0;n<r;n+=1)this.indexes[o[n]].revertUpdate(e,t);throw i}},h.prototype.getCandidates=function(e,t,n){var r,i=Object.keys(this.indexes),a=this;"function"==typeof t&&(n=t,t=!1),o.waterfall([function(t){return r=[],Object.keys(e).forEach((function(t){("string"==typeof e[t]||"number"==typeof e[t]||"boolean"==typeof e[t]||u.isDate(e[t])||null===e[t])&&r.push(t)})),(r=c.intersection(r,i)).length>0?t(null,a.indexes[r[0]].getMatching(e[r[0]])):(r=[],Object.keys(e).forEach((function(t){e[t]&&e[t].hasOwnProperty("$in")&&r.push(t)})),(r=c.intersection(r,i)).length>0?t(null,a.indexes[r[0]].getMatching(e[r[0]].$in)):(r=[],Object.keys(e).forEach((function(t){e[t]&&(e[t].hasOwnProperty("$lt")||e[t].hasOwnProperty("$lte")||e[t].hasOwnProperty("$gt")||e[t].hasOwnProperty("$gte"))&&r.push(t)})),(r=c.intersection(r,i)).length>0?t(null,a.indexes[r[0]].getBetweenBounds(e[r[0]])):t(null,a.getAllData())))},function(e){if(t)return n(null,e);var r=[],i=[],s=Object.keys(a.ttlIndexes);e.forEach((function(e){var t=!0;s.forEach((function(n){void 0!==e[n]&&u.isDate(e[n])&&Date.now()>e[n].getTime()+1e3*a.ttlIndexes[n]&&(t=!1)})),t?i.push(e):r.push(e._id)})),o.eachSeries(r,(function(e,t){a._remove({_id:e},{},(function(e){return e?n(e):t()}))}),(function(e){return n(null,i)}))}])},h.prototype._insert=function(e,t){var n,r=t||function(){};try{n=this.prepareDocumentForInsertion(e),this._insertInCache(n)}catch(e){return r(e)}this.persistence.persistNewState(u.isArray(n)?n:[n],(function(e){return e?r(e):r(null,i.deepCopy(n))}))},h.prototype.createNewId=function(){var e=r.uid(16);return this.indexes._id.getMatching(e).length>0&&(e=this.createNewId()),e},h.prototype.prepareDocumentForInsertion=function(e){var t,n=this;if(u.isArray(e))t=[],e.forEach((function(e){t.push(n.prepareDocumentForInsertion(e))}));else{void 0===(t=i.deepCopy(e))._id&&(t._id=this.createNewId());var r=new Date;this.timestampData&&void 0===t.createdAt&&(t.createdAt=r),this.timestampData&&void 0===t.updatedAt&&(t.updatedAt=r),i.checkObject(t)}return t},h.prototype._insertInCache=function(e){u.isArray(e)?this._insertMultipleDocsInCache(e):this.addToIndexes(e)},h.prototype._insertMultipleDocsInCache=function(e){var t,n,r;for(t=0;t<e.length;t+=1)try{this.addToIndexes(e[t])}catch(e){r=e,n=t;break}if(r){for(t=0;t<n;t+=1)this.removeFromIndexes(e[t]);throw r}},h.prototype.insert=function(){this.executor.push({this:this,fn:this._insert,arguments:arguments})},h.prototype.count=function(e,t){var n=new f(this,e,(function(e,t,n){return e?n(e):n(null,t.length)}));if("function"!=typeof t)return n;n.exec(t)},h.prototype.find=function(e,t,n){switch(arguments.length){case 1:t={};break;case 2:"function"==typeof t&&(n=t,t={})}var r=new f(this,e,(function(e,t,n){var r,o=[];if(e)return n(e);for(r=0;r<t.length;r+=1)o.push(i.deepCopy(t[r]));return n(null,o)}));if(r.projection(t),"function"!=typeof n)return r;r.exec(n)},h.prototype.findOne=function(e,t,n){switch(arguments.length){case 1:t={};break;case 2:"function"==typeof t&&(n=t,t={})}var r=new f(this,e,(function(e,t,n){return e?n(e):1===t.length?n(null,i.deepCopy(t[0])):n(null,null)}));if(r.projection(t).limit(1),"function"!=typeof n)return r;r.exec(n)},h.prototype._update=function(e,t,n,r){var a,s,u,l,h=this,p=0;"function"==typeof n&&(r=n,n={}),a=r||function(){},s=void 0!==n.multi&&n.multi,u=void 0!==n.upsert&&n.upsert,o.waterfall([function(n){if(!u)return n();new f(h,e).limit(1)._exec((function(r,o){if(r)return a(r);if(1===o.length)return n();var s;try{i.checkObject(t),s=t}catch(n){try{s=i.modify(i.deepCopy(e,!0),t)}catch(r){return a(r)}}return h._insert(s,(function(e,t){return e?a(e):a(null,1,t,!0)}))}))},function(){var r,o,u=[];h.getCandidates(e,(function(f,d){if(f)return a(f);try{for(l=0;l<d.length;l+=1)i.match(d[l],e)&&(s||0===p)&&(p+=1,h.timestampData&&(o=d[l].createdAt),r=i.modify(d[l],t),h.timestampData&&(r.createdAt=o,r.updatedAt=new Date),u.push({oldDoc:d[l],newDoc:r}))}catch(f){return a(f)}try{h.updateIndexes(u)}catch(f){return a(f)}var m=c.pluck(u,"newDoc");h.persistence.persistNewState(m,(function(e){if(e)return a(e);if(n.returnUpdatedDocs){var t=[];return m.forEach((function(e){t.push(i.deepCopy(e))})),s||(t=t[0]),a(null,p,t)}return a(null,p)}))}))}])},h.prototype.update=function(){this.executor.push({this:this,fn:this._update,arguments:arguments})},h.prototype._remove=function(e,t,n){var r,o,a=this,s=0,u=[];"function"==typeof t&&(n=t,t={}),r=n||function(){},o=void 0!==t.multi&&t.multi,this.getCandidates(e,!0,(function(t,n){if(t)return r(t);try{n.forEach((function(t){i.match(t,e)&&(o||0===s)&&(s+=1,u.push({$$deleted:!0,_id:t._id}),a.removeFromIndexes(t))}))}catch(t){return r(t)}a.persistence.persistNewState(u,(function(e){return e?r(e):r(null,s)}))}))},h.prototype.remove=function(){this.executor.push({this:this,fn:this._remove,arguments:arguments})},e.exports=h},function(e,t){e.exports=require("crypto")},function(e,t,n){var r=n(9);function i(){this.buffer=[],this.ready=!1,this.queue=r.queue((function(e,t){for(var n=[],r=0;r<e.arguments.length;r+=1)n.push(e.arguments[r]);var i=e.arguments[e.arguments.length-1];"function"==typeof i?n[n.length-1]=function(){"function"==typeof setImmediate?setImmediate(t):process.nextTick(t),i.apply(null,arguments)}:i||0===e.arguments.length?n.push((function(){t()})):n[n.length-1]=function(){t()},e.fn.apply(e.this,n)}),1)}i.prototype.push=function(e,t){this.ready||t?this.queue.push(e):this.buffer.push(e)},i.prototype.processBuffer=function(){var e;for(this.ready=!0,e=0;e<this.buffer.length;e+=1)this.queue.push(this.buffer[e]);this.buffer=[]},e.exports=i},function(e,t,n){e.exports.BinarySearchTree=n(16),e.exports.AVLTree=n(35)},function(e,t,n){var r=n(16),i=n(17),o=n(6);n(7);function a(e){this.tree=new s(e)}function s(e){e=e||{},this.left=null,this.right=null,this.parent=void 0!==e.parent?e.parent:null,e.hasOwnProperty("key")&&(this.key=e.key),this.data=e.hasOwnProperty("value")?[e.value]:[],this.unique=e.unique||!1,this.compareKeys=e.compareKeys||i.defaultCompareKeysFunction,this.checkValueEquality=e.checkValueEquality||i.defaultCheckValueEquality}o.inherits(s,r),a._AVLTree=s,s.prototype.checkHeightCorrect=function(){var e,t;if(this.hasOwnProperty("key")){if(this.left&&void 0===this.left.height)throw new Error("Undefined height for node "+this.left.key);if(this.right&&void 0===this.right.height)throw new Error("Undefined height for node "+this.right.key);if(void 0===this.height)throw new Error("Undefined height for node "+this.key);if(e=this.left?this.left.height:0,t=this.right?this.right.height:0,this.height!==1+Math.max(e,t))throw new Error("Height constraint failed for node "+this.key);this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()}},s.prototype.balanceFactor=function(){return(this.left?this.left.height:0)-(this.right?this.right.height:0)},s.prototype.checkBalanceFactors=function(){if(Math.abs(this.balanceFactor())>1)throw new Error("Tree is unbalanced at node "+this.key);this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()},s.prototype.checkIsAVLT=function(){s.super_.prototype.checkIsBST.call(this),this.checkHeightCorrect(),this.checkBalanceFactors()},a.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()},s.prototype.rightRotation=function(){var e,t,n,r,i=this,o=this.left;return o?(e=o.right,i.parent?(o.parent=i.parent,i.parent.left===i?i.parent.left=o:i.parent.right=o):o.parent=null,o.right=i,i.parent=o,i.left=e,e&&(e.parent=i),t=o.left?o.left.height:0,n=e?e.height:0,r=i.right?i.right.height:0,i.height=Math.max(n,r)+1,o.height=Math.max(t,i.height)+1,o):this},s.prototype.leftRotation=function(){var e,t,n,r,i=this,o=this.right;return o?(e=o.left,i.parent?(o.parent=i.parent,i.parent.left===i?i.parent.left=o:i.parent.right=o):o.parent=null,o.left=i,i.parent=o,i.right=e,e&&(e.parent=i),t=i.left?i.left.height:0,n=e?e.height:0,r=o.right?o.right.height:0,i.height=Math.max(t,n)+1,o.height=Math.max(r,i.height)+1,o):this},s.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},s.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},s.prototype.rebalanceAlongPath=function(e){var t,n,r=this;if(!this.hasOwnProperty("key"))return delete this.height,this;for(n=e.length-1;n>=0;n-=1)e[n].height=1+Math.max(e[n].left?e[n].left.height:0,e[n].right?e[n].right.height:0),e[n].balanceFactor()>1&&(t=e[n].rightTooSmall(),0===n&&(r=t)),e[n].balanceFactor()<-1&&(t=e[n].leftTooSmall(),0===n&&(r=t));return r},s.prototype.insert=function(e,t){var n=[],r=this;if(!this.hasOwnProperty("key"))return this.key=e,this.data.push(t),this.height=1,this;for(;;){if(0===r.compareKeys(r.key,e)){if(r.unique){var i=new Error("Can't insert key "+e+", it violates the unique constraint");throw i.key=e,i.errorType="uniqueViolated",i}return r.data.push(t),this}if(n.push(r),r.compareKeys(e,r.key)<0){if(!r.left){n.push(r.createLeftChild({key:e,value:t}));break}r=r.left}else{if(!r.right){n.push(r.createRightChild({key:e,value:t}));break}r=r.right}}return this.rebalanceAlongPath(n)},a.prototype.insert=function(e,t){var n=this.tree.insert(e,t);n&&(this.tree=n)},s.prototype.delete=function(e,t){var n,r=[],i=this,o=[];if(!this.hasOwnProperty("key"))return this;for(;0!==i.compareKeys(e,i.key);)if(o.push(i),i.compareKeys(e,i.key)<0){if(!i.left)return this;i=i.left}else{if(!i.right)return this;i=i.right}if(i.data.length>1&&t)return i.data.forEach((function(e){i.checkValueEquality(e,t)||r.push(e)})),i.data=r,this;if(!i.left&&!i.right)return i===this?(delete i.key,i.data=[],delete i.height,this):(i.parent.left===i?i.parent.left=null:i.parent.right=null,this.rebalanceAlongPath(o));if(!i.left||!i.right)return n=i.left?i.left:i.right,i===this?(n.parent=null,n):(i.parent.left===i?(i.parent.left=n,n.parent=i.parent):(i.parent.right=n,n.parent=i.parent),this.rebalanceAlongPath(o));if(o.push(i),!(n=i.left).right)return i.key=n.key,i.data=n.data,i.left=n.left,n.left&&(n.left.parent=i),this.rebalanceAlongPath(o);for(;n.right;)o.push(n),n=n.right;return i.key=n.key,i.data=n.data,n.parent.right=n.left,n.left&&(n.left.parent=n.parent),this.rebalanceAlongPath(o)},a.prototype.delete=function(e,t){var n=this.tree.delete(e,t);n&&(this.tree=n)},["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach((function(e){a.prototype[e]=function(){return this.tree[e].apply(this.tree,arguments)}})),e.exports=a},function(e,t,n){var r=n(37),i=n(4),o=n(8),a=n(9),s=n(14),u=n(15);function c(e){var t,n,r;if(this.db=e.db,this.inMemoryOnly=this.db.inMemoryOnly,this.filename=this.db.filename,this.corruptAlertThreshold=void 0!==e.corruptAlertThreshold?e.corruptAlertThreshold:.1,!this.inMemoryOnly&&this.filename&&"~"===this.filename.charAt(this.filename.length-1))throw new Error("The datafile name can't end with a ~, which is reserved for crash safe backup files");if(e.afterSerialization&&!e.beforeDeserialization)throw new Error("Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss");if(!e.afterSerialization&&e.beforeDeserialization)throw new Error("Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss");for(this.afterSerialization=e.afterSerialization||function(e){return e},this.beforeDeserialization=e.beforeDeserialization||function(e){return e},t=1;t<30;t+=1)for(n=0;n<10;n+=1)if(r=s.uid(t),this.beforeDeserialization(this.afterSerialization(r))!==r)throw new Error("beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss");this.filename&&e.nodeWebkitAppName&&(console.log("=================================================================="),console.log("WARNING: The nodeWebkitAppName option is deprecated"),console.log("To get the path to the directory where Node Webkit stores the data"),console.log("for your app, use the internal nw.gui module like this"),console.log("require('nw.gui').App.dataPath"),console.log("See https://github.com/rogerwang/node-webkit/issues/500"),console.log("=================================================================="),this.filename=c.getNWAppFilename(e.nodeWebkitAppName,this.filename))}c.ensureDirectoryExists=function(e,t){var n=t||function(){};r.mkdirp(e,(function(e){return n(e)}))},c.getNWAppFilename=function(e,t){var n;switch(process.platform){case"win32":case"win64":if(!(n=process.env.LOCALAPPDATA||process.env.APPDATA))throw new Error("Couldn't find the base application data folder");n=i.join(n,e);break;case"darwin":if(!(n=process.env.HOME))throw new Error("Couldn't find the base application data directory");n=i.join(n,"Library","Application Support",e);break;case"linux":if(!(n=process.env.HOME))throw new Error("Couldn't find the base application data directory");n=i.join(n,".config",e);break;default:throw new Error("Can't use the Node Webkit relative path for platform "+process.platform)}return i.join(n,"nedb-data",t)},c.prototype.persistCachedDatabase=function(e){var t=e||function(){},n="",i=this;if(this.inMemoryOnly)return t(null);this.db.getAllData().forEach((function(e){n+=i.afterSerialization(o.serialize(e))+"\n"})),Object.keys(this.db.indexes).forEach((function(e){"_id"!=e&&(n+=i.afterSerialization(o.serialize({$$indexCreated:{fieldName:e,unique:i.db.indexes[e].unique,sparse:i.db.indexes[e].sparse}}))+"\n")})),r.crashSafeWriteFile(this.filename,n,(function(e){return e?t(e):(i.db.emit("compaction.done"),t(null))}))},c.prototype.compactDatafile=function(){this.db.executor.push({this:this,fn:this.persistCachedDatabase,arguments:[]})},c.prototype.setAutocompactionInterval=function(e){var t=this,n=Math.max(e||0,5e3);this.stopAutocompaction(),this.autocompactionIntervalId=setInterval((function(){t.compactDatafile()}),n)},c.prototype.stopAutocompaction=function(){this.autocompactionIntervalId&&clearInterval(this.autocompactionIntervalId)},c.prototype.persistNewState=function(e,t){var n=this,i="",a=t||function(){};return n.inMemoryOnly?a(null):(e.forEach((function(e){i+=n.afterSerialization(o.serialize(e))+"\n"})),0===i.length?a(null):void r.appendFile(n.filename,i,"utf8",(function(e){return a(e)})))},c.prototype.treatRawData=function(e){var t,n=e.split("\n"),r={},i=[],a={},s=-1;for(t=0;t<n.length;t+=1){var u;try{(u=o.deserialize(this.beforeDeserialization(n[t])))._id?!0===u.$$deleted?delete r[u._id]:r[u._id]=u:u.$$indexCreated&&null!=u.$$indexCreated.fieldName?a[u.$$indexCreated.fieldName]=u.$$indexCreated:"string"==typeof u.$$indexRemoved&&delete a[u.$$indexRemoved]}catch(e){s+=1}}if(n.length>0&&s/n.length>this.corruptAlertThreshold)throw new Error("More than "+Math.floor(100*this.corruptAlertThreshold)+"% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss");return Object.keys(r).forEach((function(e){i.push(r[e])})),{data:i,indexes:a}},c.prototype.loadDatabase=function(e){var t=e||function(){},n=this;if(n.db.resetIndexes(),n.inMemoryOnly)return t(null);a.waterfall([function(e){c.ensureDirectoryExists(i.dirname(n.filename),(function(t){r.ensureDatafileIntegrity(n.filename,(function(t){r.readFile(n.filename,"utf8",(function(t,r){if(t)return e(t);try{var i=n.treatRawData(r)}catch(t){return e(t)}Object.keys(i.indexes).forEach((function(e){n.db.indexes[e]=new u(i.indexes[e])}));try{n.db.resetIndexes(i.data)}catch(t){return n.db.resetIndexes(),e(t)}n.db.persistence.persistCachedDatabase(e)}))}))}))}],(function(e){return e?t(e):(n.db.executor.processBuffer(),t(null))}))},e.exports=c},function(e,t,n){var r=n(3),i=n(38),o=n(9),a=n(4),s={};s.exists=r.exists,s.rename=r.rename,s.writeFile=r.writeFile,s.unlink=r.unlink,s.appendFile=r.appendFile,s.readFile=r.readFile,s.mkdirp=i,s.ensureFileDoesntExist=function(e,t){s.exists(e,(function(n){if(!n)return t(null);s.unlink(e,(function(e){return t(e)}))}))},s.flushToStorage=function(e,t){var n,i;if("string"==typeof e?(n=e,i="r+"):(n=e.filename,i=e.isDir?"r":"r+"),"r"===i&&("win32"===process.platform||"win64"===process.platform))return t(null);r.open(n,i,(function(e,n){if(e)return t(e);r.fsync(n,(function(e){r.close(n,(function(n){if(e||n){var r=new Error("Failed to flush to storage");return r.errorOnFsync=e,r.errorOnClose=n,t(r)}return t(null)}))}))}))},s.crashSafeWriteFile=function(e,t,n){var r=n||function(){},i=e+"~";o.waterfall([o.apply(s.flushToStorage,{filename:a.dirname(e),isDir:!0}),function(t){s.exists(e,(function(n){if(!n)return t();s.flushToStorage(e,(function(e){return t(e)}))}))},function(e){s.writeFile(i,t,(function(t){return e(t)}))},o.apply(s.flushToStorage,i),function(t){s.rename(i,e,(function(e){return t(e)}))},o.apply(s.flushToStorage,{filename:a.dirname(e),isDir:!0})],(function(e){return r(e)}))},s.ensureDatafileIntegrity=function(e,t){var n=e+"~";s.exists(e,(function(r){if(r)return t(null);s.exists(n,(function(r){if(!r)return s.writeFile(e,"","utf8",(function(e){t(e)}));s.rename(n,e,(function(e){return t(e)}))}))}))},e.exports=s},function(e,t,n){var r=n(4),i=n(3),o=parseInt("0777",8);function a(e,t,n,s){"function"==typeof t?(n=t,t={}):t&&"object"==typeof t||(t={mode:t});var u=t.mode,c=t.fs||i;void 0===u&&(u=o),s||(s=null);var l=n||function(){};e=r.resolve(e),c.mkdir(e,u,(function(n){if(!n)return l(null,s=s||e);switch(n.code){case"ENOENT":if(r.dirname(e)===e)return l(n);a(r.dirname(e),t,(function(n,r){n?l(n,r):a(e,t,l,r)}));break;default:c.stat(e,(function(e,t){e||!t.isDirectory()?l(n,s):l(null,s)}))}}))}e.exports=a.mkdirp=a.mkdirP=a,a.sync=function e(t,n,a){n&&"object"==typeof n||(n={mode:n});var s=n.mode,u=n.fs||i;void 0===s&&(s=o),a||(a=null),t=r.resolve(t);try{u.mkdirSync(t,s),a=a||t}catch(i){switch(i.code){case"ENOENT":a=e(r.dirname(t),n,a),e(t,n,a);break;default:var c;try{c=u.statSync(t)}catch(e){throw i}if(!c.isDirectory())throw i}}return a}},function(e,t,n){var r=n(8),i=n(7);function o(e,t,n){this.db=e,this.query=t||{},n&&(this.execFn=n)}o.prototype.limit=function(e){return this._limit=e,this},o.prototype.skip=function(e){return this._skip=e,this},o.prototype.sort=function(e){return this._sort=e,this},o.prototype.projection=function(e){return this._projection=e,this},o.prototype.project=function(e){var t,n,o,a=[],s=this;return void 0===this._projection||0===Object.keys(this._projection).length?e:(t=0!==this._projection._id,this._projection=i.omit(this._projection,"_id"),(o=Object.keys(this._projection)).forEach((function(e){if(void 0!==n&&s._projection[e]!==n)throw new Error("Can't both keep and omit fields except for _id");n=s._projection[e]})),e.forEach((function(e){var i;1===n?(i={$set:{}},o.forEach((function(t){i.$set[t]=r.getDotValue(e,t),void 0===i.$set[t]&&delete i.$set[t]})),i=r.modify({},i)):(i={$unset:{}},o.forEach((function(e){i.$unset[e]=!0})),i=r.modify(e,i)),t?i._id=e._id:delete i._id,a.push(i)})),a)},o.prototype._exec=function(e){var t,n,i,o=[],a=0,s=0,u=this,c=null;function l(t,n){return u.execFn?u.execFn(t,n,e):e(t,n)}this.db.getCandidates(this.query,(function(e,f){if(e)return l(e);try{for(t=0;t<f.length;t+=1)if(r.match(f[t],u.query))if(u._sort)o.push(f[t]);else if(u._skip&&u._skip>s)s+=1;else if(o.push(f[t]),a+=1,u._limit&&u._limit<=a)break}catch(e){return l(e)}if(u._sort){n=Object.keys(u._sort);var h=[];for(t=0;t<n.length;t++)i=n[t],h.push({key:i,direction:u._sort[i]});o.sort((function(e,t){var n,i,o;for(o=0;o<h.length;o++)if(0!==(i=(n=h[o]).direction*r.compareThings(r.getDotValue(e,n.key),r.getDotValue(t,n.key),u.db.compareStrings)))return i;return 0}));var p=u._limit||o.length,d=u._skip||0;o=o.slice(d,d+p)}try{o=u.project(o)}catch(e){c=e,o=void 0}return l(c,o)}))},o.prototype.exec=function(){this.db.executor.push({this:this,fn:this._exec,arguments:arguments})},e.exports=o},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(2);t.NimSignatureHelpProvider=class{provideSignatureHelp(e,t,n){return new Promise((n,a)=>{for(var s=e.fileName,u=0,c="",l=e.getText().split("\n"),f=t.character-1,h=t.line,p=l[h],d=0;"("!==p[f]||0!==d;)if(","!==p[f]&&";"!==p[f]||0!==d?")"===p[f]?d++:"("===p[f]&&d--:u++,--f<0){if(h-1<0)return void n();p=l[--h]}for(var m=-1,g=-1;f>=0;){if("."===p[f]){m=f;break}f--}for(;f>=0&&-1!==m;){if(-1!==p[f].search("[ \t({=]")){g=f+1;break}f--}-1===g&&(g=0),-1!==g&&(c=p.substring(g,m)),o.execNimSuggest(o.NimSuggestType.con,s,t.line+1,t.character,i.getDirtyFile(e)).then(e=>{var t=new r.SignatureHelp,i=0;e&&e.length>0&&(t.activeSignature=0),e&&e.forEach(e=>{for(var n=new r.SignatureInformation(e.type,e.documentation),o="",a=0,s=0;s<e.type.length;s++)"["===e.type[s]&&a++,a||(o+=e.type[s]),"]"===e.type[s]&&a--;var u=/(proc|macro|template|iterator|func) \((.+: .+)*\)/.exec(o);u&&u[2].split(", ").forEach(e=>{n.parameters.push(new r.ParameterInformation(e))});e.names[0]!==c&&-1===e.path.search("/"+c+"/")&&-1===e.path.search("\\\\"+c+"\\\\")||i++,t.signatures.push(n)}),t.activeParameter=i>0||""===c?u:u+1,n(t)}).catch(e=>a(e))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(5),o=n(3),a=n(1);t.NimFormattingProvider=class{provideDocumentFormattingEdits(e,t,n){return new Promise((t,n)=>{if(""===a.getNimPrettyExecPath())r.window.showInformationMessage("No 'nimpretty' binary could be found in PATH environment variable"),t([]);else{let s=a.getDirtyFile(e),u=r.workspace.getConfiguration("nim"),c=i.spawnSync(a.getNimPrettyExecPath(),["--backup:OFF","--indent:"+u.nimprettyIndent,"--maxLineLen:"+u.nimprettyMaxLineLen,s],{cwd:r.workspace.rootPath});if(0!==c.status)n(c.error);else if(o.existsSync(s)){let n=o.readFileSync(s,"utf-8"),i=e.validateRange(new r.Range(new r.Position(0,0),new r.Position(1e6,1e6)));t([r.TextEdit.replace(i,n)])}else n(s+" file not found")}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(5),o=n(11),a=n(1),s=n(2);let u={};function c(e,t,n,s,c){return new Promise((l,f)=>{if(!a.getNimExecPath())return l([]);let h=a.toLocalFile(e);if(u[h]&&u[h].initialized){let e=u[h].process;u[h]={initialized:!1,process:void 0},e&&e.kill("SIGKILL")}else u[h]={initialized:!1,process:void 0};let p=i.spawn(a.getNimExecPath(),[t,...n],{cwd:e.wsFolder.uri.fsPath});u[h].process=p,u[h].initialized=!0,p.on("error",e=>{if(e&&"ENOENT"===e.code)return r.window.showInformationMessage("No 'nim' binary could be found in PATH: '"+process.env.PATH+"'"),l([])}),p.stdout.on("data",e=>{a.outputLine("[info] nim check output:\n"+e.toString())});var d="";p.on("exit",(e,t)=>{if("SIGKILL"===t)f([]);else{u[h]={initialized:!1,process:void 0};try{let e=d.split(o.EOL);if(1===e.length){var n=e[0].split("\n");n.length>e.length&&(e=n)}var r=c(e);l(r)}catch(e){f(e)}}}),s?p.stderr.on("data",e=>{d+=e.toString()}):p.stdout.on("data",e=>{d+=e.toString()})})}function l(e){for(var t=[],n="",r={file:"",column:"",line:""},i=0;i<e.length;i++){let s=e[i].trim();if(s.startsWith("Hint:"))continue;let u=/^([^(]*)?\((\d+)(,\s(\d+))?\)( (\w+):)? (.*)/.exec(s);if(u){let[,e,i,,s,,c,l]=u;"template/generic instantiation from here"===l?a.isWorkspaceFile(e)&&(r={file:e,column:s,line:i}):(""!==n&&t.length>0&&(t[t.length-1].msg+=o.EOL+n),n="",a.isWorkspaceFile(e)?t.push({file:e,line:parseInt(i),column:parseInt(s),msg:l,severity:c}):""!==r.file&&t.push({file:r.file,line:parseInt(r.line),column:parseInt(r.column),msg:l,severity:c}),r={file:"",column:"",line:""})}else n.length<1024&&(n+=o.EOL+s)}return""!==n&&t.length>0&&(t[t.length-1].msg+=o.EOL+n),t}var f;t.check=function(e,t){var n=[];if(t.useNimsuggestCheck)n.push(new Promise((t,n)=>{s.execNimSuggest(s.NimSuggestType.chk,e,0,0,"").then(e=>{e&&e.length>0?t(function(e){for(var t=[],n=0;n<e.length;n++){let r=e[n];"???"===r.path&&"Hint"===r.type||t.push({file:r.path,line:r.line,column:r.column,msg:r.documentation,severity:r.type})}return t}(e)):t([])}).catch(e=>n(e))}));else if(a.isProjectMode())a.getProjects().forEach(e=>{n.push(c(e,"check",["--listFullPaths",e.filePath],!0,l))});else{let t=a.getProjectFileInfo(e);n.push(c(t,"check",["--listFullPaths",t.filePath],!0,l))}return Promise.all(n).then(e=>[].concat.apply([],e))},t.activateEvalConsole=function(){r.window.onDidCloseTerminal(e=>{f&&e.processId===f.processId&&(f=void 0)})},t.execSelectionInTerminal=function(e){if(r.window.activeTextEditor){if(!a.getNimExecPath())return;f||((f=r.window.createTerminal("Nim Console")).show(!0),f.sendText(a.getNimExecPath()+" secret\n")),f.sendText(r.window.activeTextEditor.document.getText(r.window.activeTextEditor.selection))}}}]);
//# sourceMappingURL=nimMain.js.map